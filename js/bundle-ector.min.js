var require=function(file,cwd){var resolved=require.resolve(file,cwd||'/');var mod=require.modules[resolved];if(!mod)throw new Error('Failed to resolve module '+file+', tried '+resolved);var cached=require.cache[resolved];var res=cached?cached.exports:mod();return res;};require.paths=[];require.modules={};require.cache={};require.extensions=[".js",".coffee",".json"];require._core={'assert':true,'events':true,'fs':true,'path':true,'vm':true};require.resolve=(function(){return function(x,cwd){if(!cwd)cwd='/';if(require._core[x])return x;var path=require.modules.path();cwd=path.resolve('/',cwd);var y=cwd||'/';if(x.match(/^(?:\.\.?\/|\/)/)){var m=loadAsFileSync(path.resolve(y,x))||loadAsDirectorySync(path.resolve(y,x));if(m)return m;}
var n=loadNodeModulesSync(x,y);if(n)return n;throw new Error("Cannot find module '"+x+"'");function loadAsFileSync(x){x=path.normalize(x);if(require.modules[x]){return x;}
for(var i=0;i<require.extensions.length;i++){var ext=require.extensions[i];if(require.modules[x+ext])return x+ext;}}
function loadAsDirectorySync(x){x=x.replace(/\/+$/,'');var pkgfile=path.normalize(x+'/package.json');if(require.modules[pkgfile]){var pkg=require.modules[pkgfile]();var b=pkg.browserify;if(typeof b==='object'&&b.main){var m=loadAsFileSync(path.resolve(x,b.main));if(m)return m;}
else if(typeof b==='string'){var m=loadAsFileSync(path.resolve(x,b));if(m)return m;}
else if(pkg.main){var m=loadAsFileSync(path.resolve(x,pkg.main));if(m)return m;}}
return loadAsFileSync(x+'/index');}
function loadNodeModulesSync(x,start){var dirs=nodeModulesPathsSync(start);for(var i=0;i<dirs.length;i++){var dir=dirs[i];var m=loadAsFileSync(dir+'/'+x);if(m)return m;var n=loadAsDirectorySync(dir+'/'+x);if(n)return n;}
var m=loadAsFileSync(x);if(m)return m;}
function nodeModulesPathsSync(start){var parts;if(start==='/')parts=[''];else parts=path.normalize(start).split('/');var dirs=[];for(var i=parts.length-1;i>=0;i--){if(parts[i]==='node_modules')continue;var dir=parts.slice(0,i+1).join('/')+'/node_modules';dirs.push(dir);}
return dirs;}};})();require.alias=function(from,to){var path=require.modules.path();var res=null;try{res=require.resolve(from+'/package.json','/');}
catch(err){res=require.resolve(from,'/');}
var basedir=path.dirname(res);var keys=(Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res;})(require.modules);for(var i=0;i<keys.length;i++){var key=keys[i];if(key.slice(0,basedir.length+1)===basedir+'/'){var f=key.slice(basedir.length);require.modules[to+f]=require.modules[basedir+f];}
else if(key===basedir){require.modules[to]=require.modules[basedir];}}};(function(){var process={};var global=typeof window!=='undefined'?window:{};var definedProcess=false;require.define=function(filename,fn){if(!definedProcess&&require.modules.__browserify_process){process=require.modules.__browserify_process();definedProcess=true;}
var dirname=require._core[filename]?'':require.modules.path().dirname(filename);var require_=function(file){var requiredModule=require(file,dirname);var cached=require.cache[require.resolve(file,dirname)];if(cached&&cached.parent===null){cached.parent=module_;}
return requiredModule;};require_.resolve=function(name){return require.resolve(name,dirname);};require_.modules=require.modules;require_.define=require.define;require_.cache=require.cache;var module_={id:filename,filename:filename,exports:{},loaded:false,parent:null};require.modules[filename]=function(){require.cache[filename]=module_;fn.call(module_.exports,require_,module_,module_.exports,dirname,filename,process,global);module_.loaded=true;return module_.exports;};};})();require.define("path",function(require,module,exports,__dirname,__filename,process,global){function filter(xs,fn){var res=[];for(var i=0;i<xs.length;i++){if(fn(xs[i],i,xs))res.push(xs[i]);}
return res;}
function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length;i>=0;i--){var last=parts[i];if(last=='.'){parts.splice(i,1);}else if(last==='..'){parts.splice(i,1);up++;}else if(up){parts.splice(i,1);up--;}}
if(allowAboveRoot){for(;up--;up){parts.unshift('..');}}
return parts;}
var splitPathRe=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;exports.resolve=function(){var resolvedPath='',resolvedAbsolute=false;for(var i=arguments.length;i>=-1&&!resolvedAbsolute;i--){var path=(i>=0)?arguments[i]:process.cwd();if(typeof path!=='string'||!path){continue;}
resolvedPath=path+'/'+resolvedPath;resolvedAbsolute=path.charAt(0)==='/';}
resolvedPath=normalizeArray(filter(resolvedPath.split('/'),function(p){return!!p;}),!resolvedAbsolute).join('/');return((resolvedAbsolute?'/':'')+resolvedPath)||'.';};exports.normalize=function(path){var isAbsolute=path.charAt(0)==='/',trailingSlash=path.slice(-1)==='/';path=normalizeArray(filter(path.split('/'),function(p){return!!p;}),!isAbsolute).join('/');if(!path&&!isAbsolute){path='.';}
if(path&&trailingSlash){path+='/';}
return(isAbsolute?'/':'')+path;};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){return p&&typeof p==='string';}).join('/'));};exports.dirname=function(path){var dir=splitPathRe.exec(path)[1]||'';var isWindows=false;if(!dir){return'.';}else if(dir.length===1||(isWindows&&dir.length<=3&&dir.charAt(1)===':')){return dir;}else{return dir.substring(0,dir.length-1);}};exports.basename=function(path,ext){var f=splitPathRe.exec(path)[2]||'';if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length);}
return f;};exports.extname=function(path){return splitPathRe.exec(path)[3]||'';};});require.define("__browserify_process",function(require,module,exports,__dirname,__filename,process,global){var process=module.exports={};process.nextTick=(function(){var canSetImmediate=typeof window!=='undefined'&&window.setImmediate;var canPost=typeof window!=='undefined'&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)};}
if(canPost){var queue=[];window.addEventListener('message',function(ev){if(ev.source===window&&ev.data==='browserify-tick'){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn();}}},true);return function nextTick(fn){queue.push(fn);window.postMessage('browserify-tick','*');};}
return function nextTick(fn){setTimeout(fn,0);};})();process.title='browser';process.browser=true;process.env={};process.argv=[];process.binding=function(name){if(name==='evals')return(require)('vm')
else throw new Error('No such module. (Possibly not yet loaded)')};(function(){var cwd='/';var path;process.cwd=function(){return cwd};process.chdir=function(dir){if(!path)path=require('path');cwd=path.resolve(dir,cwd);};})();});require.define("ector",function(require,module,exports,__dirname,__filename,process,global){"use strict";var debug=require('debug')('ector:lib');var sugar=require('sugar');var Tokenizer=require('sentence-tokenizer');var concept_network=require('concept-network');var ConceptNetwork=concept_network.ConceptNetwork;var ConceptNetworkState=concept_network.ConceptNetworkState;var rwc=require('random-weighted-choice');function Ector(botname,username){this.name="ECTOR";var name;if(botname){name=this.setName(botname);}
this.username="Guy";var user;if(name instanceof Error){debug('name',name);}
if(user instanceof Error){debug('user',user);}
this.cn=new ConceptNetwork();this.cns={};this.lastSentenceNodeId=null;if(username){user=this.setUser(username);}
else{user=this.setUser(this.username);}}
Ector.prototype={rwc:rwc,setUser:function(username){if(typeof username!=='string'){return new Error("Username should be a string");}
if(username.length===0){return new Error("Username should not be empty");}
if(username.length<3){return new Error("Username should be at least 3 characters long");}
this.username=username;if(typeof this.cns[this.username]==='undefined'){this.cns[this.username]=new ConceptNetworkState(this.cn);}
this.lastSentenceNodeId=null;return this.username;},setName:function(botname){if(typeof botname!=='string'){return new Error("botname should be a string");}
this.name=botname;return this.name;},addEntry:function(entry,cns){if(typeof entry!=='string'){return new Error("entry should be a string");}
if(entry.length===0){return new Error("entry should not be empty");}
cns=cns||this.cns[this.username];var tokenizer=new Tokenizer(this.username,this.name);tokenizer.setEntry(entry);var sentences=tokenizer.getSentences();var tokens=[];var tokenNodes=[];var sentenceNode;var prevTokenNode;var curTokenNode;var curToken;for(var sentenceIndex in sentences){tokens=tokens.concat(tokenizer.getTokens(sentenceIndex));sentenceNode=this.cn.addNode('s'+sentences[sentenceIndex]);if(Number(sentenceIndex)===0){this.lastSentenceNodeId=sentenceNode.id;}
cns.activate(sentenceNode.id);prevTokenNode=null;for(var tokenIndex in tokens){curToken=tokens[tokenIndex];curTokenNode=this.cn.addNode('w'+curToken);if(tokenIndex>0&&tokenIndex<tokens.length-1){if(typeof curTokenNode.mid==='undefined'){curTokenNode.mid=1;}
else{curTokenNode.mid+=1;}}
this.cn.addLink(sentenceNode.id,curTokenNode.id);tokenNodes=tokenNodes.concat(curTokenNode);cns.activate(curTokenNode.id);if(prevTokenNode){this.cn.addLink(prevTokenNode.id,curTokenNode.id);}
prevTokenNode=curTokenNode;}
if(typeof tokenNodes[0].beg==='undefined'){tokenNodes[0].beg=1;}
else{tokenNodes[0].beg+=1;}
if(typeof tokenNodes[tokenNodes.length-1].end==='undefined'){tokenNodes[tokenNodes.length-1].end=1;}
else{tokenNodes[tokenNodes.length-1].end+=1;}}
return tokenNodes;},generateForward:function(phraseNodes,temperature){var outgoingLinks=this.cn.getNodeFromLinks(phraseNodes[phraseNodes.length-1].id);var nextNodes=[];for(var ol in outgoingLinks){var linkId=outgoingLinks[ol];var link=this.cn.link[linkId];var toNode=this.cn.node[link.toId];if(toNode.label.slice(0,1)==='w'){var activationValue=this.cns[this.username].getActivationValue(toNode.id);activationValue=Math.max(activationValue,1);var repeatNb=phraseNodes.count(toNode);var len=toNode.label.length;if(repeatNb*len<=5*3){var repetition=1+repeatNb*repeatNb*len;nextNodes.push({id:toNode.id,weight:link.coOcc*activationValue/repetition});}}}
if(nextNodes.length===0){return phraseNodes;}
var chosenItem=this.rwc(nextNodes,temperature);var chosenTokenNode=this.cn.node[chosenItem];phraseNodes.push(chosenTokenNode);return this.generateForward(phraseNodes,temperature);},generateBackward:function(phraseNodes,temperature){var incomingLinks=this.cn.getNodeToLinks(phraseNodes[0].id);var previousNodes=[];for(var ol in incomingLinks){var linkId=incomingLinks[ol];var link=this.cn.link[linkId];var fromNode=this.cn.node[link.fromId];if(fromNode.label.slice(0,1)==='w'){var activationValue=this.cns[this.username].getActivationValue(fromNode.id);activationValue=Math.max(activationValue,1);var repeatNb=phraseNodes.count(fromNode);var len=fromNode.label.length;if(repeatNb*len<=5*3){var repetition=1+repeatNb*repeatNb*len;previousNodes.push({id:fromNode.id,weight:link.coOcc*activationValue/repetition});}}}
if(previousNodes.length===0){return phraseNodes;}
var chosenItem=this.rwc(previousNodes,temperature);var chosenTokenNode=this.cn.node[chosenItem];phraseNodes=[chosenTokenNode].concat(phraseNodes);return this.generateBackward(phraseNodes,temperature);},generateResponse:function(){var cns=this.cns[this.username];cns.propagate();var maxActivationValue=cns.getMaximumActivationValue('w');var tokens=cns.getActivatedTypedNodes('w',maxActivationValue-10);var toChoose=[];for(var i in tokens){toChoose.push({weight:tokens[i].activationValue,id:tokens[i].node.id});}
var temperature=60;var chosenItem=this.rwc(toChoose,temperature);var chosenTokenNode=this.cn.node[chosenItem];var phraseNodes=[chosenTokenNode];phraseNodes=this.generateForward(phraseNodes,temperature);phraseNodes=this.generateBackward(phraseNodes,temperature);var sentence=phraseNodes.map(function(node){return node.label.slice(1);}).join(' ');var nodes=phraseNodes.map(function(node){return node.id;});sentence=sentence.replace("{yourname}",this.username);sentence=sentence.replace("{myname}",this.name);return{sentence:sentence,nodes:nodes};},linkNodesToLastSentence:function(nodes){for(var i in nodes){var nodeId=nodes[i];this.cn.addLink(nodeId,this.lastSentenceNodeId);}}};module.exports=Ector;});require.define("/node_modules/debug/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={"main":"index","browserify":"debug.component.js"}});require.define("/node_modules/debug/debug.component.js",function(require,module,exports,__dirname,__filename,process,global){;(function(){function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+' '+fmt+' +'+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments);}}
debug.names=[];debug.skips=[];debug.enable=function(name){localStorage.debug=name;var split=(name||'').split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace('*','.*?');if(name[0]==='-'){debug.skips.push(new RegExp('^'+name.substr(1)+'$'));}
else{debug.names.push(new RegExp('^'+name+'$'));}}};debug.disable=function(){debug.enable('');};debug.humanize=function(ms){var sec=1000,min=60*1000,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+'h';if(ms>=min)return(ms/min).toFixed(1)+'m';if(ms>=sec)return(ms/sec|0)+'s';return ms+'ms';};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false;}}
for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true;}}
return false;};if(window.localStorage)debug.enable(localStorage.debug);module.exports=debug;})();});require.define("/node_modules/sugar/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={"main":"./release/1.3.7/sugar-1.3.7-full.development.js"}});require.define("/node_modules/sugar/release/1.3.7/sugar-1.3.7-full.development.js",function(require,module,exports,__dirname,__filename,process,global){(function(){var object=Object,array=Array,regexp=RegExp,date=Date,string=String,number=Number,math=Math,Undefined;var globalContext=typeof global!=='undefined'?global:this;var definePropertySupport=object.defineProperty&&object.defineProperties;var ClassNames='Array,Boolean,Date,Function,Number,String,RegExp'.split(',');var isArray=buildClassCheck(ClassNames[0]);var isBoolean=buildClassCheck(ClassNames[1]);var isDate=buildClassCheck(ClassNames[2]);var isFunction=buildClassCheck(ClassNames[3]);var isNumber=buildClassCheck(ClassNames[4]);var isString=buildClassCheck(ClassNames[5]);var isRegExp=buildClassCheck(ClassNames[6]);function buildClassCheck(type){return function(obj){return className(obj)==='[object '+type+']';}}
function className(obj){return object.prototype.toString.call(obj);}
function initializeClasses(){initializeClass(object);iterateOverObject(ClassNames,function(i,name){initializeClass(globalContext[name]);});}
function initializeClass(klass){if(klass['SugarMethods'])return;defineProperty(klass,'SugarMethods',{});extend(klass,false,false,{'restore':function(){var all=arguments.length===0,methods=multiArgs(arguments);iterateOverObject(klass['SugarMethods'],function(name,m){if(all||methods.indexOf(name)>-1){defineProperty(m.instance?klass.prototype:klass,name,m.method);}});},'extend':function(methods,override,instance){extend(klass,instance!==false,override,methods);}});}
function extend(klass,instance,override,methods){var extendee=instance?klass.prototype:klass,original;initializeClass(klass);iterateOverObject(methods,function(name,method){original=extendee[name];if(typeof override==='function'){method=wrapNative(extendee[name],method,override);}
if(override!==false||!extendee[name]){defineProperty(extendee,name,method);}
klass['SugarMethods'][name]={instance:instance,method:method,original:original};});}
function extendSimilar(klass,instance,override,set,fn){var methods={};set=isString(set)?set.split(','):set;set.forEach(function(name,i){fn(methods,name,i);});extend(klass,instance,override,methods);}
function wrapNative(nativeFn,extendedFn,condition){return function(){if(nativeFn&&(condition===true||!condition.apply(this,arguments))){return nativeFn.apply(this,arguments);}else{return extendedFn.apply(this,arguments);}}}
function defineProperty(target,name,method){if(definePropertySupport){object.defineProperty(target,name,{'value':method,'configurable':true,'enumerable':false,'writable':true});}else{target[name]=method;}}
function multiArgs(args,fn){var result=[],i;for(i=0;i<args.length;i++){result.push(args[i]);if(fn)fn.call(args,args[i],i);}
return result;}
function flattenedArgs(obj,fn,from){multiArgs(array.prototype.concat.apply([],array.prototype.slice.call(obj,from||0)),fn);}
function checkCallback(fn){if(!fn||!fn.call){throw new TypeError('Callback is not callable');}}
function isDefined(o){return o!==Undefined;}
function isUndefined(o){return o===Undefined;}
function isObjectPrimitive(obj){return obj&&typeof obj==='object';}
function isObject(obj){return!!obj&&className(obj)==='[object Object]'&&'hasOwnProperty'in obj;}
function hasOwnProperty(obj,key){return object['hasOwnProperty'].call(obj,key);}
function iterateOverObject(obj,fn){var key;for(key in obj){if(!hasOwnProperty(obj,key))continue;if(fn.call(obj,key,obj[key],obj)===false)break;}}
function simpleMerge(target,source){iterateOverObject(source,function(key){target[key]=source[key];});return target;}
function Hash(obj){simpleMerge(this,obj);};Hash.prototype.constructor=object;function getRange(start,stop,fn,step){var arr=[],i=parseInt(start),down=step<0;while((!down&&i<=stop)||(down&&i>=stop)){arr.push(i);if(fn)fn.call(this,i);i+=step||1;}
return arr;}
function round(val,precision,method){var fn=math[method||'round'];var multiplier=math.pow(10,math.abs(precision||0));if(precision<0)multiplier=1/multiplier;return fn(val*multiplier)/multiplier;}
function ceil(val,precision){return round(val,precision,'ceil');}
function floor(val,precision){return round(val,precision,'floor');}
function padNumber(num,place,sign,base){var str=math.abs(num).toString(base||10);str=repeatString(place-str.replace(/\.\d+/,'').length,'0')+str;if(sign||num<0){str=(num<0?'-':'+')+str;}
return str;}
function getOrdinalizedSuffix(num){if(num>=11&&num<=13){return'th';}else{switch(num%10){case 1:return'st';case 2:return'nd';case 3:return'rd';default:return'th';}}}
function getTrimmableCharacters(){return'\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF';}
function repeatString(times,str){return array(math.max(0,isDefined(times)?times:1)+1).join(str||'');}
function getRegExpFlags(reg,add){var flags=reg.toString().match(/[^/]*$/)[0];if(add){flags=(flags+add).split('').sort().join('').replace(/([gimy])\1+/g,'$1');}
return flags;}
function escapeRegExp(str){if(!isString(str))str=string(str);return str.replace(/([\\/'*+?|()\[\]{}.^$])/g,'\\$1');}
function stringify(thing,stack){var type=typeof thing,thingIsObject,thingIsArray,klass,value,arr,key,i;if(type==='string')return thing;klass=object.prototype.toString.call(thing)
thingIsObject=isObject(thing);thingIsArray=klass==='[object Array]';if(thing!=null&&thingIsObject||thingIsArray){if(!stack)stack=[];if(stack.length>1){i=stack.length;while(i--){if(stack[i]===thing){return'CYC';}}}
stack.push(thing);value=string(thing.constructor);arr=thingIsArray?thing:object.keys(thing).sort();for(i=0;i<arr.length;i++){key=thingIsArray?i:arr[i];value+=key+stringify(thing[key],stack);}
stack.pop();}else if(1/thing===-Infinity){value='-0';}else{value=string(thing&&thing.valueOf?thing.valueOf():thing);}
return type+klass+value;}
function isEqual(a,b){if(objectIsMatchedByValue(a)&&objectIsMatchedByValue(b)){return stringify(a)===stringify(b);}else{return a===b;}}
function objectIsMatchedByValue(obj){var klass=className(obj);return klass==='[object Date]'||klass==='[object Array]'||klass==='[object String]'||klass==='[object Number]'||klass==='[object RegExp]'||klass==='[object Boolean]'||klass==='[object Arguments]'||isObject(obj);}
function entryAtIndex(arr,args,str){var result=[],length=arr.length,loop=args[args.length-1]!==false,r;multiArgs(args,function(index){if(isBoolean(index))return false;if(loop){index=index%length;if(index<0)index=length+index;}
r=str?arr.charAt(index)||'':arr[index];result.push(r);});return result.length<2?result[0]:result;}
function buildObjectInstanceMethods(set,target){extendSimilar(target,true,false,set,function(methods,name){methods[name+(name==='equal'?'s':'')]=function(){return object[name].apply(null,[this].concat(multiArgs(arguments)));}});}
initializeClasses();extend(object,false,false,{'keys':function(obj){var keys=[];if(!isObjectPrimitive(obj)&&!isRegExp(obj)&&!isFunction(obj)){throw new TypeError('Object required');}
iterateOverObject(obj,function(key,value){keys.push(key);});return keys;}});function arrayIndexOf(arr,search,fromIndex,increment){var length=arr.length,fromRight=increment==-1,start=fromRight?length-1:0,index=toIntegerWithDefault(fromIndex,start);if(index<0){index=length+index;}
if((!fromRight&&index<0)||(fromRight&&index>=length)){index=start;}
while((fromRight&&index>=0)||(!fromRight&&index<length)){if(arr[index]===search){return index;}
index+=increment;}
return-1;}
function arrayReduce(arr,fn,initialValue,fromRight){var length=arr.length,count=0,defined=isDefined(initialValue),result,index;checkCallback(fn);if(length==0&&!defined){throw new TypeError('Reduce called on empty array with no initial value');}else if(defined){result=initialValue;}else{result=arr[fromRight?length-1:count];count++;}
while(count<length){index=fromRight?length-count-1:count;if(index in arr){result=fn(result,arr[index],index,arr);}
count++;}
return result;}
function toIntegerWithDefault(i,d){if(isNaN(i)){return d;}else{return parseInt(i>>0);}}
function checkFirstArgumentExists(args){if(args.length===0){throw new TypeError('First argument must be defined');}}
extend(array,false,false,{'isArray':function(obj){return isArray(obj);}});extend(array,true,false,{'every':function(fn,scope){var length=this.length,index=0;checkFirstArgumentExists(arguments);while(index<length){if(index in this&&!fn.call(scope,this[index],index,this)){return false;}
index++;}
return true;},'some':function(fn,scope){var length=this.length,index=0;checkFirstArgumentExists(arguments);while(index<length){if(index in this&&fn.call(scope,this[index],index,this)){return true;}
index++;}
return false;},'map':function(fn,scope){var length=this.length,index=0,result=new Array(length);checkFirstArgumentExists(arguments);while(index<length){if(index in this){result[index]=fn.call(scope,this[index],index,this);}
index++;}
return result;},'filter':function(fn,scope){var length=this.length,index=0,result=[];checkFirstArgumentExists(arguments);while(index<length){if(index in this&&fn.call(scope,this[index],index,this)){result.push(this[index]);}
index++;}
return result;},'indexOf':function(search,fromIndex){if(isString(this))return this.indexOf(search,fromIndex);return arrayIndexOf(this,search,fromIndex,1);},'lastIndexOf':function(search,fromIndex){if(isString(this))return this.lastIndexOf(search,fromIndex);return arrayIndexOf(this,search,fromIndex,-1);},'forEach':function(fn,scope){var length=this.length,index=0;checkCallback(fn);while(index<length){if(index in this){fn.call(scope,this[index],index,this);}
index++;}},'reduce':function(fn,init){return arrayReduce(this,fn,init);},'reduceRight':function(fn,init){return arrayReduce(this,fn,init,true);}});function buildTrim(){var support=getTrimmableCharacters().match(/^\s+$/);try{string.prototype.trim.call([1]);}catch(e){support=false;}
extend(string,true,!support,{'trim':function(){return this.toString().trimLeft().trimRight();},'trimLeft':function(){return this.replace(regexp('^['+getTrimmableCharacters()+']+'),'');},'trimRight':function(){return this.replace(regexp('['+getTrimmableCharacters()+']+$'),'');}});}
extend(Function,true,false,{'bind':function(scope){var fn=this,args=multiArgs(arguments).slice(1),nop,bound;if(!isFunction(this)){throw new TypeError('Function.prototype.bind called on a non-function');}
bound=function(){return fn.apply(fn.prototype&&this instanceof fn?this:scope,args.concat(multiArgs(arguments)));}
bound.prototype=this.prototype;return bound;}});extend(date,false,false,{'now':function(){return new date().getTime();}});function buildISOString(){var d=new date(date.UTC(1999,11,31)),target='1999-12-31T00:00:00.000Z';var support=d.toISOString&&d.toISOString()===target;extendSimilar(date,true,!support,'toISOString,toJSON',function(methods,name){methods[name]=function(){return padNumber(this.getUTCFullYear(),4)+'-'+padNumber(this.getUTCMonth()+1,2)+'-'+padNumber(this.getUTCDate(),2)+'T'+padNumber(this.getUTCHours(),2)+':'+padNumber(this.getUTCMinutes(),2)+':'+padNumber(this.getUTCSeconds(),2)+'.'+padNumber(this.getUTCMilliseconds(),3)+'Z';}});}
buildTrim();buildISOString();function multiMatch(el,match,scope,params){var result=true;if(el===match){return true;}else if(isRegExp(match)&&isString(el)){return regexp(match).test(el);}else if(isFunction(match)){return match.apply(scope,params);}else if(isObject(match)&&isObjectPrimitive(el)){iterateOverObject(match,function(key,value){if(!multiMatch(el[key],match[key],scope,[el[key],el])){result=false;}});return result;}else{return isEqual(el,match);}}
function transformArgument(el,map,context,mapArgs){if(isUndefined(map)){return el;}else if(isFunction(map)){return map.apply(context,mapArgs||[]);}else if(isFunction(el[map])){return el[map].call(el);}else{return el[map];}}
function arrayEach(arr,fn,startIndex,loop){var length,index,i;if(startIndex<0)startIndex=arr.length+startIndex;i=isNaN(startIndex)?0:startIndex;length=loop===true?arr.length+i:arr.length;while(i<length){index=i%arr.length;if(!(index in arr)){return iterateOverSparseArray(arr,fn,i,loop);}else if(fn.call(arr,arr[index],index,arr)===false){break;}
i++;}}
function iterateOverSparseArray(arr,fn,fromIndex,loop){var indexes=[],i;for(i in arr){if(isArrayIndex(arr,i)&&i>=fromIndex){indexes.push(parseInt(i));}}
indexes.sort().each(function(index){return fn.call(arr,arr[index],index,arr);});return arr;}
function isArrayIndex(arr,i){return i in arr&&toUInt32(i)==i&&i!=0xffffffff;}
function toUInt32(i){return i>>>0;}
function arrayFind(arr,f,startIndex,loop,returnIndex){var result,index;arrayEach(arr,function(el,i,arr){if(multiMatch(el,f,arr,[el,i,arr])){result=el;index=i;return false;}},startIndex,loop);return returnIndex?index:result;}
function arrayUnique(arr,map){var result=[],o={},transformed;arrayEach(arr,function(el,i){transformed=map?transformArgument(el,map,arr,[el,i,arr]):el;if(!checkForElementInHashAndSet(o,transformed)){result.push(el);}})
return result;}
function arrayIntersect(arr1,arr2,subtract){var result=[],o={};arr2.each(function(el){checkForElementInHashAndSet(o,el);});arr1.each(function(el){var stringified=stringify(el),isReference=!objectIsMatchedByValue(el);if(elementExistsInHash(o,stringified,el,isReference)!=subtract){discardElementFromHash(o,stringified,el,isReference);result.push(el);}});return result;}
function arrayFlatten(arr,level,current){level=level||Infinity;current=current||0;var result=[];arrayEach(arr,function(el){if(isArray(el)&&current<level){result=result.concat(arrayFlatten(el,level,current+1));}else{result.push(el);}});return result;}
function flatArguments(args){var result=[];multiArgs(args,function(arg){result=result.concat(arg);});return result;}
function elementExistsInHash(hash,key,element,isReference){var exists=key in hash;if(isReference){if(!hash[key]){hash[key]=[];}
exists=hash[key].indexOf(element)!==-1;}
return exists;}
function checkForElementInHashAndSet(hash,element){var stringified=stringify(element),isReference=!objectIsMatchedByValue(element),exists=elementExistsInHash(hash,stringified,element,isReference);if(isReference){hash[stringified].push(element);}else{hash[stringified]=element;}
return exists;}
function discardElementFromHash(hash,key,element,isReference){var arr,i=0;if(isReference){arr=hash[key];while(i<arr.length){if(arr[i]===element){arr.splice(i,1);}else{i+=1;}}}else{delete hash[key];}}
function getMinOrMax(obj,map,which,all){var edge,result=[],max=which==='max',min=which==='min',isArray=Array.isArray(obj);iterateOverObject(obj,function(key){var el=obj[key],test=transformArgument(el,map,obj,isArray?[el,parseInt(key),obj]:[]);if(isUndefined(test)){throw new TypeError('Cannot compare with undefined');}
if(test===edge){result.push(el);}else if(isUndefined(edge)||(max&&test>edge)||(min&&test<edge)){result=[el];edge=test;}});if(!isArray)result=arrayFlatten(result,1);return all?result:result[0];}
function collateStrings(a,b){var aValue,bValue,aChar,bChar,aEquiv,bEquiv,index=0,tiebreaker=0;a=getCollationReadyString(a);b=getCollationReadyString(b);do{aChar=getCollationCharacter(a,index);bChar=getCollationCharacter(b,index);aValue=getCollationValue(aChar);bValue=getCollationValue(bChar);if(aValue===-1||bValue===-1){aValue=a.charCodeAt(index)||null;bValue=b.charCodeAt(index)||null;}
aEquiv=aChar!==a.charAt(index);bEquiv=bChar!==b.charAt(index);if(aEquiv!==bEquiv&&tiebreaker===0){tiebreaker=aEquiv-bEquiv;}
index+=1;}while(aValue!=null&&bValue!=null&&aValue===bValue);if(aValue===bValue)return tiebreaker;return aValue<bValue?-1:1;}
function getCollationReadyString(str){if(array[AlphanumericSortIgnoreCase]){str=str.toLowerCase();}
return str.replace(array[AlphanumericSortIgnore],'');}
function getCollationCharacter(str,index){var chr=str.charAt(index),eq=array[AlphanumericSortEquivalents]||{};return eq[chr]||chr;}
function getCollationValue(chr){var order=array[AlphanumericSortOrder];if(!chr){return null;}else{return order.indexOf(chr);}}
var AlphanumericSortOrder='AlphanumericSortOrder';var AlphanumericSortIgnore='AlphanumericSortIgnore';var AlphanumericSortIgnoreCase='AlphanumericSortIgnoreCase';var AlphanumericSortEquivalents='AlphanumericSortEquivalents';function buildEnhancements(){var callbackCheck=function(){var a=arguments;return a.length>0&&!isFunction(a[0]);};extendSimilar(array,true,callbackCheck,'map,every,all,some,any,none,filter',function(methods,name){methods[name]=function(f){return this[name](function(el,index){if(name==='map'){return transformArgument(el,f,this,[el,index,this]);}else{return multiMatch(el,f,this,[el,index,this]);}});}});}
function buildAlphanumericSort(){var order='AÁÀÂÃĄBCĆČÇDĎÐEÉÈĚÊËĘFGĞHıIÍÌİÎÏJKLŁMNŃŇÑOÓÒÔPQRŘSŚŠŞTŤUÚÙŮÛÜVWXYÝZŹŻŽÞÆŒØÕÅÄÖ';var equiv='AÁÀÂÃÄ,CÇ,EÉÈÊË,IÍÌİÎÏ,OÓÒÔÕÖ,Sß,UÚÙÛÜ';array[AlphanumericSortOrder]=order.split('').map(function(str){return str+str.toLowerCase();}).join('');var equivalents={};arrayEach(equiv.split(','),function(set){var equivalent=set.charAt(0);arrayEach(set.slice(1).split(''),function(chr){equivalents[chr]=equivalent;equivalents[chr.toLowerCase()]=equivalent.toLowerCase();});});array[AlphanumericSortIgnoreCase]=true;array[AlphanumericSortEquivalents]=equivalents;}
extend(array,false,false,{'create':function(){var result=[],tmp;multiArgs(arguments,function(a){if(isObjectPrimitive(a)){try{tmp=array.prototype.slice.call(a,0);if(tmp.length>0){a=tmp;}}catch(e){};}
result=result.concat(a);});return result;}});extend(array,true,false,{'find':function(f,index,loop){return arrayFind(this,f,index,loop);},'findAll':function(f,index,loop){var result=[];arrayEach(this,function(el,i,arr){if(multiMatch(el,f,arr,[el,i,arr])){result.push(el);}},index,loop);return result;},'findIndex':function(f,startIndex,loop){var index=arrayFind(this,f,startIndex,loop,true);return isUndefined(index)?-1:index;},'count':function(f){if(isUndefined(f))return this.length;return this.findAll(f).length;},'removeAt':function(start,end){if(isUndefined(start))return this;if(isUndefined(end))end=start;for(var i=0;i<=(end-start);i++){this.splice(start,1);}
return this;},'include':function(el,index){return this.clone().add(el,index);},'exclude':function(){return array.prototype.remove.apply(this.clone(),arguments);},'clone':function(){return simpleMerge([],this);},'unique':function(map){return arrayUnique(this,map);},'flatten':function(limit){return arrayFlatten(this,limit);},'union':function(){return arrayUnique(this.concat(flatArguments(arguments)));},'intersect':function(){return arrayIntersect(this,flatArguments(arguments),false);},'subtract':function(a){return arrayIntersect(this,flatArguments(arguments),true);},'at':function(){return entryAtIndex(this,arguments);},'first':function(num){if(isUndefined(num))return this[0];if(num<0)num=0;return this.slice(0,num);},'last':function(num){if(isUndefined(num))return this[this.length-1];var start=this.length-num<0?0:this.length-num;return this.slice(start);},'from':function(num){return this.slice(num);},'to':function(num){if(isUndefined(num))num=this.length;return this.slice(0,num);},'min':function(map,all){return getMinOrMax(this,map,'min',all);},'max':function(map,all){return getMinOrMax(this,map,'max',all);},'least':function(map,all){return getMinOrMax(this.groupBy.apply(this,[map]),'length','min',all);},'most':function(map,all){return getMinOrMax(this.groupBy.apply(this,[map]),'length','max',all);},'sum':function(map){var arr=map?this.map(map):this;return arr.length>0?arr.reduce(function(a,b){return a+b;}):0;},'average':function(map){var arr=map?this.map(map):this;return arr.length>0?arr.sum()/arr.length:0;},'inGroups':function(num,padding){var pad=arguments.length>1;var arr=this;var result=[];var divisor=ceil(this.length/num);getRange(0,num-1,function(i){var index=i*divisor;var group=arr.slice(index,index+divisor);if(pad&&group.length<divisor){getRange(1,divisor-group.length,function(){group=group.add(padding);});}
result.push(group);});return result;},'inGroupsOf':function(num,padding){var result=[],len=this.length,arr=this,group;if(len===0||num===0)return arr;if(isUndefined(num))num=1;if(isUndefined(padding))padding=null;getRange(0,ceil(len/num)-1,function(i){group=arr.slice(num*i,num*i+num);while(group.length<num){group.push(padding);}
result.push(group);});return result;},'isEmpty':function(){return this.compact().length==0;},'sortBy':function(map,desc){var arr=this.clone();arr.sort(function(a,b){var aProperty,bProperty,comp;aProperty=transformArgument(a,map,arr,[a]);bProperty=transformArgument(b,map,arr,[b]);if(isString(aProperty)&&isString(bProperty)){comp=collateStrings(aProperty,bProperty);}else if(aProperty<bProperty){comp=-1;}else if(aProperty>bProperty){comp=1;}else{comp=0;}
return comp*(desc?-1:1);});return arr;},'randomize':function(){var a=this.concat();for(var j,x,i=a.length;i;j=parseInt(math.random()*i),x=a[--i],a[i]=a[j],a[j]=x){};return a;},'zip':function(){var args=multiArgs(arguments);return this.map(function(el,i){return[el].concat(args.map(function(k){return(i in k)?k[i]:null;}));});},'sample':function(num){var arr=this.randomize();return arguments.length>0?arr.slice(0,num):arr[0];},'each':function(fn,index,loop){arrayEach(this,fn,index,loop);return this;},'add':function(el,index){if(!isNumber(number(index))||isNaN(index))index=this.length;array.prototype.splice.apply(this,[index,0].concat(el));return this;},'remove':function(){var i,arr=this;multiArgs(arguments,function(f){i=0;while(i<arr.length){if(multiMatch(arr[i],f,arr,[arr[i],i,arr])){arr.splice(i,1);}else{i++;}}});return arr;},'compact':function(all){var result=[];arrayEach(this,function(el,i){if(isArray(el)){result.push(el.compact());}else if(all&&el){result.push(el);}else if(!all&&el!=null&&el.valueOf()===el.valueOf()){result.push(el);}});return result;},'groupBy':function(map,fn){var arr=this,result={},key;arrayEach(arr,function(el,index){key=transformArgument(el,map,arr,[el,index,arr]);if(!result[key])result[key]=[];result[key].push(el);});if(fn){iterateOverObject(result,fn);}
return result;},'none':function(){return!this.any.apply(this,arguments);}});extend(array,true,false,{'all':array.prototype.every,'any':array.prototype.some,'insert':array.prototype.add});function keysWithCoercion(obj){if(obj&&obj.valueOf){obj=obj.valueOf();}
return object.keys(obj);}
function buildEnumerableMethods(names,mapping){extendSimilar(object,false,false,names,function(methods,name){methods[name]=function(obj,arg1,arg2){var result;var x=keysWithCoercion(obj);result=array.prototype[name].call(x,function(key){if(mapping){return transformArgument(obj[key],arg1,obj,[key,obj[key],obj]);}else{return multiMatch(obj[key],arg1,obj,[key,obj[key],obj]);}},arg2);if(isArray(result)){result=result.reduce(function(o,key,i){o[key]=obj[key];return o;},{});}
return result;};});buildObjectInstanceMethods(names,Hash);}
extend(object,false,false,{'map':function(obj,map){return keysWithCoercion(obj).reduce(function(result,key){result[key]=transformArgument(obj[key],map,obj,[key,obj[key],obj]);return result;},{});},'reduce':function(obj){var values=keysWithCoercion(obj).map(function(key){return obj[key];});return values.reduce.apply(values,multiArgs(arguments).slice(1));},'each':function(obj,fn){checkCallback(fn);iterateOverObject(obj,fn);return obj;},'size':function(obj){return keysWithCoercion(obj).length;}});var EnumerableFindingMethods='any,all,none,count,find,findAll,isEmpty'.split(',');var EnumerableMappingMethods='sum,average,min,max,least,most'.split(',');var EnumerableOtherMethods='map,reduce,size'.split(',');var EnumerableMethods=EnumerableFindingMethods.concat(EnumerableMappingMethods).concat(EnumerableOtherMethods);buildEnhancements();buildAlphanumericSort();buildEnumerableMethods(EnumerableFindingMethods);buildEnumerableMethods(EnumerableMappingMethods,true);buildObjectInstanceMethods(EnumerableOtherMethods,Hash);var English;var CurrentLocalization;var TimeFormat=['ampm','hour','minute','second','ampm','utc','offset_sign','offset_hours','offset_minutes','ampm']
var DecimalReg='(?:[,.]\\d+)?';var HoursReg='\\d{1,2}'+DecimalReg;var SixtyReg='[0-5]\\d'+DecimalReg;var RequiredTime='({t})?\\s*('+HoursReg+')(?:{h}('+SixtyReg+')?{m}(?::?('+SixtyReg+'){s})?\\s*(?:({t})|(Z)|(?:([+-])(\\d{2,2})(?::?(\\d{2,2}))?)?)?|\\s*({t}))';var KanjiDigits='〇一二三四五六七八九十百千万';var FullWidthDigits='０１２３４５６７８９';var AsianDigitMap={};var AsianDigitReg;var DateArgumentUnits;var DateUnitsReversed;var CoreDateFormats=[];var DateOutputFormats=[{token:'f{1,4}|ms|milliseconds',format:function(d){return callDateGet(d,'Milliseconds');}},{token:'ss?|seconds',format:function(d,len){return callDateGet(d,'Seconds');}},{token:'mm?|minutes',format:function(d,len){return callDateGet(d,'Minutes');}},{token:'hh?|hours|12hr',format:function(d){return getShortHour(d);}},{token:'HH?|24hr',format:function(d){return callDateGet(d,'Hours');}},{token:'dd?|date|day',format:function(d){return callDateGet(d,'Date');}},{token:'dow|weekday',word:true,format:function(d,loc,n,t){var dow=callDateGet(d,'Day');return loc['weekdays'][dow+(n-1)*7];}},{token:'MM?',format:function(d){return callDateGet(d,'Month')+1;}},{token:'mon|month',word:true,format:function(d,loc,n,len){var month=callDateGet(d,'Month');return loc['months'][month+(n-1)*12];}},{token:'y{2,4}|year',format:function(d){return callDateGet(d,'FullYear');}},{token:'[Tt]{1,2}',format:function(d,loc,n,format){if(loc['ampm'].length==0)return'';var hours=callDateGet(d,'Hours');var str=loc['ampm'][floor(hours/12)];if(format.length===1)str=str.slice(0,1);if(format.slice(0,1)==='T')str=str.toUpperCase();return str;}},{token:'z{1,4}|tz|timezone',text:true,format:function(d,loc,n,format){var tz=d.getUTCOffset();if(format=='z'||format=='zz'){tz=tz.replace(/(\d{2})(\d{2})/,function(f,h,m){return padNumber(h,format.length);});}
return tz;}},{token:'iso(tz|timezone)',format:function(d){return d.getUTCOffset(true);}},{token:'ord',format:function(d){var date=callDateGet(d,'Date');return date+getOrdinalizedSuffix(date);}}];var DateUnits=[{unit:'year',method:'FullYear',ambiguous:true,multiplier:function(d){var adjust=d?(d.isLeapYear()?1:0):0.25;return(365+adjust)*24*60*60*1000;}},{unit:'month',method:'Month',ambiguous:true,multiplier:function(d,ms){var days=30.4375,inMonth;if(d){inMonth=d.daysInMonth();if(ms<=inMonth.days()){days=inMonth;}}
return days*24*60*60*1000;},error:0.919},{unit:'week',method:'Week',multiplier:function(){return 7*24*60*60*1000;}},{unit:'day',method:'Date',ambiguous:true,multiplier:function(){return 24*60*60*1000;}},{unit:'hour',method:'Hours',multiplier:function(){return 60*60*1000;}},{unit:'minute',method:'Minutes',multiplier:function(){return 60*1000;}},{unit:'second',method:'Seconds',multiplier:function(){return 1000;}},{unit:'millisecond',method:'Milliseconds',multiplier:function(){return 1;}}];var Localizations={};function Localization(l){simpleMerge(this,l);this.compiledFormats=CoreDateFormats.concat();}
Localization.prototype={getMonth:function(n){if(isNumber(n)){return n-1;}else{return this['months'].indexOf(n)%12;}},getWeekday:function(n){return this['weekdays'].indexOf(n)%7;},getNumber:function(n){var i;if(isNumber(n)){return n;}else if(n&&(i=this['numbers'].indexOf(n))!==-1){return(i+1)%10;}else{return 1;}},getNumericDate:function(n){var self=this;return n.replace(regexp(this['num'],'g'),function(d){var num=self.getNumber(d);return num||'';});},getEnglishUnit:function(n){return English['units'][this['units'].indexOf(n)%8];},getRelativeFormat:function(adu){return this.convertAdjustedToFormat(adu,adu[2]>0?'future':'past');},getDuration:function(ms){return this.convertAdjustedToFormat(getAdjustedUnit(ms),'duration');},hasVariant:function(code){code=code||this.code;return code==='en'||code==='en-US'?true:this['variant'];},matchAM:function(str){return str===this['ampm'][0];},matchPM:function(str){return str&&str===this['ampm'][1];},convertAdjustedToFormat:function(adu,mode){var sign,unit,mult,num=adu[0],u=adu[1],ms=adu[2],format=this[mode]||this['relative'];if(isFunction(format)){return format.call(this,num,u,ms,mode);}
mult=this['plural']&&num>1?1:0;unit=this['units'][mult*8+u]||this['units'][u];if(this['capitalizeUnit'])unit=simpleCapitalize(unit);sign=this['modifiers'].filter(function(m){return m.name=='sign'&&m.value==(ms>0?1:-1);})[0];return format.replace(/\{(.*?)\}/g,function(full,match){switch(match){case'num':return num;case'unit':return unit;case'sign':return sign.src;}});},getFormats:function(){return this.cachedFormat?[this.cachedFormat].concat(this.compiledFormats):this.compiledFormats;},addFormat:function(src,allowsTime,match,variant,iso){var to=match||[],loc=this,time,timeMarkers,lastIsNumeral;src=src.replace(/\s+/g,'[-,. ]*');src=src.replace(/\{([^,]+?)\}/g,function(all,k){var value,arr,result,opt=k.match(/\?$/),nc=k.match(/^(\d+)\??$/),slice=k.match(/(\d)(?:-(\d))?/),key=k.replace(/[^a-z]+$/,'');if(nc){value=loc['tokens'][nc[1]];}else if(loc[key]){value=loc[key];}else if(loc[key+'s']){value=loc[key+'s'];if(slice){arr=[];value.forEach(function(m,i){var mod=i%(loc['units']?8:value.length);if(mod>=slice[1]&&mod<=(slice[2]||slice[1])){arr.push(m);}});value=arr;}
value=arrayToAlternates(value);}
if(nc){result='(?:'+value+')';}else{if(!match){to.push(key);}
result='('+value+')';}
if(opt){result+='?';}
return result;});if(allowsTime){time=prepareTime(RequiredTime,loc,iso);timeMarkers=['t','[\\s\\u3000]'].concat(loc['timeMarker']);lastIsNumeral=src.match(/\\d\{\d,\d\}\)+\??$/);addDateInputFormat(loc,'(?:'+time+')[,\\s\\u3000]+?'+src,TimeFormat.concat(to),variant);addDateInputFormat(loc,src+'(?:[,\\s]*(?:'+timeMarkers.join('|')+(lastIsNumeral?'+':'*')+')'+time+')?',to.concat(TimeFormat),variant);}else{addDateInputFormat(loc,src,to,variant);}}};function getLocalization(localeCode,fallback){var loc;if(!isString(localeCode))localeCode='';loc=Localizations[localeCode]||Localizations[localeCode.slice(0,2)];if(fallback===false&&!loc){throw new Error('Invalid locale.');}
return loc||CurrentLocalization;}
function setLocalization(localeCode,set){var loc,canAbbreviate;function initializeField(name){var val=loc[name];if(isString(val)){loc[name]=val.split(',');}else if(!val){loc[name]=[];}}
function eachAlternate(str,fn){str=str.split('+').map(function(split){return split.replace(/(.+):(.+)$/,function(full,base,suffixes){return suffixes.split('|').map(function(suffix){return base+suffix;}).join('|');});}).join('|');return str.split('|').forEach(fn);}
function setArray(name,abbreviate,multiple){var arr=[];loc[name].forEach(function(full,i){if(abbreviate){full+='+'+full.slice(0,3);}
eachAlternate(full,function(day,j){arr[j*multiple+i]=day.toLowerCase();});});loc[name]=arr;}
function getDigit(start,stop,allowNumbers){var str='\\d{'+start+','+stop+'}';if(allowNumbers)str+='|(?:'+arrayToAlternates(loc['numbers'])+')+';return str;}
function getNum(){var arr=['\\d+'].concat(loc['articles']);if(loc['numbers'])arr=arr.concat(loc['numbers']);return arrayToAlternates(arr);}
function setDefault(name,value){loc[name]=loc[name]||value;}
function setModifiers(){var arr=[];loc.modifiersByName={};loc['modifiers'].forEach(function(modifier){var name=modifier.name;eachAlternate(modifier.src,function(t){var locEntry=loc[name];loc.modifiersByName[t]=modifier;arr.push({name:name,src:t,value:modifier.value});loc[name]=locEntry?locEntry+'|'+t:t;});});loc['day']+='|'+arrayToAlternates(loc['weekdays']);loc['modifiers']=arr;}
loc=new Localization(set);initializeField('modifiers');'months,weekdays,units,numbers,articles,tokens,timeMarker,ampm,timeSuffixes,dateParse,timeParse'.split(',').forEach(initializeField);canAbbreviate=!loc['monthSuffix'];setArray('months',canAbbreviate,12);setArray('weekdays',canAbbreviate,7);setArray('units',false,8);setArray('numbers',false,10);setDefault('code',localeCode);setDefault('date',getDigit(1,2,loc['digitDate']));setDefault('year',"'\\d{2}|"+getDigit(4,4));setDefault('num',getNum());setModifiers();if(loc['monthSuffix']){loc['month']=getDigit(1,2);loc['months']=getRange(1,12).map(function(n){return n+loc['monthSuffix'];});}
loc['full_month']=getDigit(1,2)+'|'+arrayToAlternates(loc['months']);if(loc['timeSuffixes'].length>0){loc.addFormat(prepareTime(RequiredTime,loc),false,TimeFormat)}
loc.addFormat('{day}',true);loc.addFormat('{month}'+(loc['monthSuffix']||''));loc.addFormat('{year}'+(loc['yearSuffix']||''));loc['timeParse'].forEach(function(src){loc.addFormat(src,true);});loc['dateParse'].forEach(function(src){loc.addFormat(src);});return Localizations[localeCode]=loc;}
function addDateInputFormat(locale,format,match,variant){locale.compiledFormats.unshift({variant:variant,locale:locale,reg:regexp('^'+format+'$','i'),to:match});}
function simpleCapitalize(str){return str.slice(0,1).toUpperCase()+str.slice(1);}
function arrayToAlternates(arr){return arr.filter(function(el){return!!el;}).join('|');}
function collectDateArguments(args,allowDuration){var obj,arr;if(isObject(args[0])){return args;}else if(isNumber(args[0])&&!isNumber(args[1])){return[args[0]];}else if(isString(args[0])&&allowDuration){return[getDateParamsFromString(args[0]),args[1]];}
obj={};DateArgumentUnits.forEach(function(u,i){obj[u.unit]=args[i];});return[obj];}
function getDateParamsFromString(str,num){var params={};match=str.match(/^(\d+)?\s?(\w+?)s?$/i);if(match){if(isUndefined(num)){num=parseInt(match[1])||1;}
params[match[2].toLowerCase()]=num;}
return params;}
function getFormatMatch(match,arr){var obj={},value,num;arr.forEach(function(key,i){value=match[i+1];if(isUndefined(value)||value==='')return;if(key==='year'){obj.yearAsString=value.replace(/'/,'');}
num=parseFloat(value.replace(/'/,'').replace(/,/,'.'));obj[key]=!isNaN(num)?num:value.toLowerCase();});return obj;}
function cleanDateInput(str){str=str.trim().replace(/^(just )?now|\.+$/i,'');return convertAsianDigits(str);}
function convertAsianDigits(str){return str.replace(AsianDigitReg,function(full,disallowed,match){var sum=0,place=1,lastWasHolder,lastHolder;if(disallowed)return full;match.split('').reverse().forEach(function(letter){var value=AsianDigitMap[letter],holder=value>9;if(holder){if(lastWasHolder)sum+=place;place*=value/(lastHolder||1);lastHolder=value;}else{if(lastWasHolder===false){place*=10;}
sum+=place*value;}
lastWasHolder=holder;});if(lastWasHolder)sum+=place;return sum;});}
function getExtendedDate(f,localeCode,prefer,forceUTC){var d=new date(),relative=false,baseLocalization,loc,format,set,unit,weekday,num,tmp,after;d.utc(forceUTC);if(isDate(f)){d.utc(f.isUTC()).setTime(f.getTime());}else if(isNumber(f)){d.setTime(f);}else if(isObject(f)){d.set(f,true);set=f;}else if(isString(f)){baseLocalization=getLocalization(localeCode);f=cleanDateInput(f);if(baseLocalization){iterateOverObject(baseLocalization.getFormats(),function(i,dif){var match=f.match(dif.reg);if(match){format=dif;loc=format.locale;set=getFormatMatch(match,format.to,loc);if(set['utc']){d.utc();}
loc.cachedFormat=format;if(set.timestamp){set=set.timestamp;return false;}
if(format.variant&&!isString(set['month'])&&(isString(set['date'])||baseLocalization.hasVariant(localeCode))){tmp=set['month'];set['month']=set['date'];set['date']=tmp;}
if(set['year']&&set.yearAsString.length===2){set['year']=getYearFromAbbreviation(set['year']);}
if(set['month']){set['month']=loc.getMonth(set['month']);if(set['shift']&&!set['unit'])set['unit']=loc['units'][7];}
if(set['weekday']&&set['date']){delete set['weekday'];}else if(set['weekday']){set['weekday']=loc.getWeekday(set['weekday']);if(set['shift']&&!set['unit'])set['unit']=loc['units'][5];}
if(set['day']&&(tmp=loc.modifiersByName[set['day']])){set['day']=tmp.value;d.reset();relative=true;}else if(set['day']&&(weekday=loc.getWeekday(set['day']))>-1){delete set['day'];if(set['num']&&set['month']){after=function(){var w=d.getWeekday();d.setWeekday((7*(set['num']-1))+(w>weekday?weekday+7:weekday));}
set['day']=1;}else{set['weekday']=weekday;}}
if(set['date']&&!isNumber(set['date'])){set['date']=loc.getNumericDate(set['date']);}
if(loc.matchPM(set['ampm'])&&set['hour']<12){set['hour']+=12;}else if(loc.matchAM(set['ampm'])&&set['hour']===12){set['hour']=0;}
if('offset_hours'in set||'offset_minutes'in set){d.utc();set['offset_minutes']=set['offset_minutes']||0;set['offset_minutes']+=set['offset_hours']*60;if(set['offset_sign']==='-'){set['offset_minutes']*=-1;}
set['minute']-=set['offset_minutes'];}
if(set['unit']){relative=true;num=loc.getNumber(set['num']);unit=loc.getEnglishUnit(set['unit']);if(set['shift']||set['edge']){num*=(tmp=loc.modifiersByName[set['shift']])?tmp.value:0;if(unit==='month'&&isDefined(set['date'])){d.set({'day':set['date']},true);delete set['date'];}
if(unit==='year'&&isDefined(set['month'])){d.set({'month':set['month'],'day':set['date']},true);delete set['month'];delete set['date'];}}
if(set['sign']&&(tmp=loc.modifiersByName[set['sign']])){num*=tmp.value;}
if(isDefined(set['weekday'])){d.set({'weekday':set['weekday']},true);delete set['weekday'];}
set[unit]=(set[unit]||0)+num;}
if(set['year_sign']==='-'){set['year']*=-1;}
DateUnitsReversed.slice(1,4).forEach(function(u,i){var value=set[u.unit],fraction=value%1;if(fraction){set[DateUnitsReversed[i].unit]=round(fraction*(u.unit==='second'?1000:60));set[u.unit]=floor(value);}});return false;}});}
if(!format){d=f?new date(f):new date();if(forceUTC){d.addMinutes(d.getTimezoneOffset());}}else if(relative){d.advance(set);}else{if(d._utc){d.reset();}
updateDate(d,set,true,false,prefer);}
if(set&&set['edge']){tmp=loc.modifiersByName[set['edge']];iterateOverObject(DateUnitsReversed.slice(4),function(i,u){if(isDefined(set[u.unit])){unit=u.unit;return false;}});if(unit==='year')set.specificity='month';else if(unit==='month'||unit==='week')set.specificity='day';d[(tmp.value<0?'endOf':'beginningOf')+simpleCapitalize(unit)]();if(tmp.value===-2)d.reset();}
if(after){after();}
d.utc(false);}
return{date:d,set:set}}
function getYearFromAbbreviation(year){return round(callDateGet(new date(),'FullYear')/100)*100-round(year/100)*100+year;}
function getShortHour(d){var hours=callDateGet(d,'Hours');return hours===0?12:hours-(floor(hours/13)*12);}
function getWeekNumber(date){date=date.clone();var dow=callDateGet(date,'Day')||7;date.addDays(4-dow).reset();return 1+floor(date.daysSince(date.clone().beginningOfYear())/7);}
function getAdjustedUnit(ms){var next,ams=math.abs(ms),value=ams,unit=0;DateUnitsReversed.slice(1).forEach(function(u,i){next=floor(round(ams/u.multiplier()*10)/10);if(next>=1){value=next;unit=i+1;}});return[value,unit,ms];}
function formatDate(date,format,relative,localeCode){var adu,loc=getLocalization(localeCode),caps=regexp(/^[A-Z]/),value,shortcut;if(!date.isValid()){return'Invalid Date';}else if(Date[format]){format=Date[format];}else if(isFunction(format)){adu=getAdjustedUnit(date.millisecondsFromNow());format=format.apply(date,adu.concat(loc));}
if(!format&&relative){adu=adu||getAdjustedUnit(date.millisecondsFromNow());if(adu[1]===0){adu[1]=1;adu[0]=1;}
return loc.getRelativeFormat(adu);}
format=format||'long';format=loc[format]||format;DateOutputFormats.forEach(function(dof){format=format.replace(regexp('\\{('+dof.token+')(\\d)?\\}',dof.word?'i':''),function(m,t,d){var val=dof.format(date,loc,d||1,t),l=t.length,one=t.match(/^(.)\1+$/);if(dof.word){if(l===3)val=val.slice(0,3);if(one||t.match(caps))val=simpleCapitalize(val);}else if(one&&!dof.text){val=(isNumber(val)?padNumber(val,l):val.toString()).slice(-l);}
return val;});});return format;}
function compareDate(d,find,buffer,forceUTC){var p,t,min,max,minOffset,maxOffset,override,capitalized,accuracy=0,loBuffer=0,hiBuffer=0;p=getExtendedDate(find,null,null,forceUTC);if(buffer>0){loBuffer=hiBuffer=buffer;override=true;}
if(!p.date.isValid())return false;if(p.set&&p.set.specificity){DateUnits.forEach(function(u,i){if(u.unit===p.set.specificity){accuracy=u.multiplier(p.date,d-p.date)-1;}});capitalized=simpleCapitalize(p.set.specificity);if(p.set['edge']||p.set['shift']){p.date['beginningOf'+capitalized]();}
if(p.set.specificity==='month'){max=p.date.clone()['endOf'+capitalized]().getTime();}
if(!override&&p.set['sign']&&p.set.specificity!='millisecond'){loBuffer=50;hiBuffer=-50;}}
t=d.getTime();min=p.date.getTime();max=max||(min+accuracy);max=compensateForTimezoneTraversal(d,min,max);return t>=(min-loBuffer)&&t<=(max+hiBuffer);}
function compensateForTimezoneTraversal(d,min,max){var dMin,dMax,minOffset,maxOffset;dMin=new Date(min);dMax=new Date(max).utc(d.isUTC());if(callDateGet(dMax,'Hours')!==23){minOffset=dMin.getTimezoneOffset();maxOffset=dMax.getTimezoneOffset();if(minOffset!==maxOffset){max+=(maxOffset-minOffset).minutes();}}
return max;}
function updateDate(d,params,reset,advance,prefer){var weekday,specificityIndex;function getParam(key){return isDefined(params[key])?params[key]:params[key+'s'];}
function paramExists(key){return isDefined(getParam(key));}
function uniqueParamExists(key,isDay){return paramExists(key)||(isDay&&paramExists('weekday'));}
function canDisambiguate(){var now=new date;return(prefer===-1&&d>now)||(prefer===1&&d<now);}
if(isNumber(params)&&advance){params={'milliseconds':params};}else if(isNumber(params)){d.setTime(params);return d;}
if(isDefined(params['date'])){params['day']=params['date'];}
iterateOverObject(DateUnitsReversed,function(i,u){var isDay=u.unit==='day';if(uniqueParamExists(u.unit,isDay)){params.specificity=u.unit;specificityIndex=+i;return false;}else if(reset&&u.unit!=='week'&&(!isDay||!paramExists('week'))){callDateSet(d,u.method,(isDay?1:0));}});DateUnits.forEach(function(u,i){var unit=u.unit,method=u.method,higherUnit=DateUnits[i-1],value;value=getParam(unit)
if(isUndefined(value))return;if(advance){if(unit==='week'){value=(params['day']||0)+(value*7);method='Date';}
value=(value*advance)+callDateGet(d,method);}else if(unit==='month'&&paramExists('day')){callDateSet(d,'Date',15);}
callDateSet(d,method,value);if(advance&&unit==='month'){checkMonthTraversal(d,value);}});if(!advance&&!paramExists('day')&&paramExists('weekday')){var weekday=getParam('weekday'),isAhead,futurePreferred;d.setWeekday(weekday);}
if(canDisambiguate()){iterateOverObject(DateUnitsReversed.slice(specificityIndex+1),function(i,u){var ambiguous=u.ambiguous||(u.unit==='week'&&paramExists('weekday'));if(ambiguous&&!uniqueParamExists(u.unit,u.unit==='day')){d[u.addMethod](prefer);return false;}});}
return d;}
function callDateGet(d,method){return d['get'+(d._utc?'UTC':'')+method]();}
function callDateSet(d,method,value){return d['set'+(d._utc?'UTC':'')+method](value);}
function prepareTime(format,loc,iso){var timeSuffixMapping={'h':0,'m':1,'s':2},add;loc=loc||English;return format.replace(/{([a-z])}/g,function(full,token){var separators=[],isHours=token==='h',tokenIsRequired=isHours&&!iso;if(token==='t'){return loc['ampm'].join('|');}else{if(isHours){separators.push(':');}
if(add=loc['timeSuffixes'][timeSuffixMapping[token]]){separators.push(add+'\\s*');}
return separators.length===0?'':'(?:'+separators.join('|')+')'+(tokenIsRequired?'':'?');}});}
function checkMonthTraversal(date,targetMonth){if(targetMonth<0){targetMonth=targetMonth%12+12;}
if(targetMonth%12!=callDateGet(date,'Month')){callDateSet(date,'Date',0);}}
function createDate(args,prefer,forceUTC){var f,localeCode;if(isNumber(args[1])){f=collectDateArguments(args)[0];}else{f=args[0];localeCode=args[1];}
return getExtendedDate(f,localeCode,prefer,forceUTC).date;}
function buildDateUnits(){DateUnitsReversed=DateUnits.concat().reverse();DateArgumentUnits=DateUnits.concat();DateArgumentUnits.splice(2,1);}
function buildDateMethods(){extendSimilar(date,true,false,DateUnits,function(methods,u,i){var unit=u.unit,caps=simpleCapitalize(unit),multiplier=u.multiplier(),since,until;u.addMethod='add'+caps+'s';function applyErrorMargin(ms){var num=ms/multiplier,fraction=num%1,error=u.error||0.999;if(fraction&&math.abs(fraction%1)>error){num=round(num);}
return parseInt(num);}
since=function(f,localeCode){return applyErrorMargin(this.getTime()-date.create(f,localeCode).getTime());};until=function(f,localeCode){return applyErrorMargin(date.create(f,localeCode).getTime()-this.getTime());};methods[unit+'sAgo']=until;methods[unit+'sUntil']=until;methods[unit+'sSince']=since;methods[unit+'sFromNow']=since;methods[u.addMethod]=function(num,reset){var set={};set[unit]=num;return this.advance(set,reset);};buildNumberToDateAlias(u,multiplier);if(i<3){['Last','This','Next'].forEach(function(shift){methods['is'+shift+caps]=function(){return this.is(shift+' '+unit);};});}
if(i<4){methods['beginningOf'+caps]=function(){var set={};switch(unit){case'year':set['year']=callDateGet(this,'FullYear');break;case'month':set['month']=callDateGet(this,'Month');break;case'day':set['day']=callDateGet(this,'Date');break;case'week':set['weekday']=0;break;}
return this.set(set,true);};methods['endOf'+caps]=function(){var set={'hours':23,'minutes':59,'seconds':59,'milliseconds':999};switch(unit){case'year':set['month']=11;set['day']=31;break;case'month':set['day']=this.daysInMonth();break;case'week':set['weekday']=6;break;}
return this.set(set,true);};}});}
function buildCoreInputFormats(){English.addFormat('([+-])?(\\d{4,4})[-.]?{full_month}[-.]?(\\d{1,2})?',true,['year_sign','year','month','date'],false,true);English.addFormat('(\\d{1,2})[-.\\/]{full_month}(?:[-.\\/](\\d{2,4}))?',true,['date','month','year'],true);English.addFormat('{full_month}[-.](\\d{4,4})',false,['month','year']);English.addFormat('\\/Date\\((\\d+(?:\\+\\d{4,4})?)\\)\\/',false,['timestamp'])
English.addFormat(prepareTime(RequiredTime,English),false,TimeFormat)
CoreDateFormats=English.compiledFormats.slice(0,7).reverse();English.compiledFormats=English.compiledFormats.slice(7).concat(CoreDateFormats);}
function buildDateOutputShortcuts(){extendSimilar(date,true,false,'short,long,full',function(methods,name){methods[name]=function(localeCode){return formatDate(this,name,false,localeCode);}});}
function buildAsianDigits(){KanjiDigits.split('').forEach(function(digit,value){var holder;if(value>9){value=math.pow(10,value-9);}
AsianDigitMap[digit]=value;});FullWidthDigits.split('').forEach(function(digit,value){AsianDigitMap[digit]=value;});AsianDigitReg=regexp('([期週周])?(['+KanjiDigits+FullWidthDigits+']+)(?!昨)','g');}
function buildRelativeAliases(){var special='today,yesterday,tomorrow,weekday,weekend,future,past'.split(',');var weekdays=English['weekdays'].slice(0,7);var months=English['months'].slice(0,12);extendSimilar(date,true,false,special.concat(weekdays).concat(months),function(methods,name){methods['is'+simpleCapitalize(name)]=function(utc){return this.is(name,0,utc);};});}
function buildUTCAliases(){date.extend({'utc':{'create':function(){return createDate(arguments,0,true);},'past':function(){return createDate(arguments,-1,true);},'future':function(){return createDate(arguments,1,true);}}},false,false);}
function setDateProperties(){date.extend({'RFC1123':'{Dow}, {dd} {Mon} {yyyy} {HH}:{mm}:{ss} {tz}','RFC1036':'{Weekday}, {dd}-{Mon}-{yy} {HH}:{mm}:{ss} {tz}','ISO8601_DATE':'{yyyy}-{MM}-{dd}','ISO8601_DATETIME':'{yyyy}-{MM}-{dd}T{HH}:{mm}:{ss}.{fff}{isotz}'},false,false);}
date.extend({'create':function(){return createDate(arguments);},'past':function(){return createDate(arguments,-1);},'future':function(){return createDate(arguments,1);},'addLocale':function(localeCode,set){return setLocalization(localeCode,set);},'setLocale':function(localeCode,set){var loc=getLocalization(localeCode,false);CurrentLocalization=loc;if(localeCode&&localeCode!=loc['code']){loc['code']=localeCode;}
return loc;},'getLocale':function(localeCode){return!localeCode?CurrentLocalization:getLocalization(localeCode,false);},'addFormat':function(format,match,localeCode){addDateInputFormat(getLocalization(localeCode),format,match);}},false,false);date.extend({'set':function(){var args=collectDateArguments(arguments);return updateDate(this,args[0],args[1])},'setWeekday':function(dow){if(isUndefined(dow))return;return callDateSet(this,'Date',callDateGet(this,'Date')+dow-callDateGet(this,'Day'));},'setWeek':function(week){if(isUndefined(week))return;var date=callDateGet(this,'Date');callDateSet(this,'Month',0);callDateSet(this,'Date',(week*7)+1);return this.getTime();},'getWeek':function(){return getWeekNumber(this);},'getUTCOffset':function(iso){var offset=this._utc?0:this.getTimezoneOffset();var colon=iso===true?':':'';if(!offset&&iso)return'Z';return padNumber(round(-offset/60),2,true)+colon+padNumber(offset%60,2);},'utc':function(set){defineProperty(this,'_utc',set===true||arguments.length===0);return this;},'isUTC':function(){return!!this._utc||this.getTimezoneOffset()===0;},'advance':function(){var args=collectDateArguments(arguments,true);return updateDate(this,args[0],args[1],1);},'rewind':function(){var args=collectDateArguments(arguments,true);return updateDate(this,args[0],args[1],-1);},'isValid':function(){return!isNaN(this.getTime());},'isAfter':function(d,margin,utc){return this.getTime()>date.create(d).getTime()-(margin||0);},'isBefore':function(d,margin){return this.getTime()<date.create(d).getTime()+(margin||0);},'isBetween':function(d1,d2,margin){var t=this.getTime();var t1=date.create(d1).getTime();var t2=date.create(d2).getTime();var lo=math.min(t1,t2);var hi=math.max(t1,t2);margin=margin||0;return(lo-margin<t)&&(hi+margin>t);},'isLeapYear':function(){var year=callDateGet(this,'FullYear');return(year%4===0&&year%100!==0)||(year%400===0);},'daysInMonth':function(){return 32-callDateGet(new date(callDateGet(this,'FullYear'),callDateGet(this,'Month'),32),'Date');},'format':function(f,localeCode){return formatDate(this,f,false,localeCode);},'relative':function(f,localeCode){if(isString(f)){localeCode=f;f=null;}
return formatDate(this,f,true,localeCode);},'is':function(d,margin,utc){var tmp,comp;if(!this.isValid())return;if(isString(d)){d=d.trim().toLowerCase();comp=this.clone().utc(utc);switch(true){case d==='future':return this.getTime()>new date().getTime();case d==='past':return this.getTime()<new date().getTime();case d==='weekday':return callDateGet(comp,'Day')>0&&callDateGet(comp,'Day')<6;case d==='weekend':return callDateGet(comp,'Day')===0||callDateGet(comp,'Day')===6;case(tmp=English['weekdays'].indexOf(d)%7)>-1:return callDateGet(comp,'Day')===tmp;case(tmp=English['months'].indexOf(d)%12)>-1:return callDateGet(comp,'Month')===tmp;}}
return compareDate(this,d,margin,utc);},'reset':function(unit){var params={},recognized;unit=unit||'hours';if(unit==='date')unit='days';recognized=DateUnits.some(function(u){return unit===u.unit||unit===u.unit+'s';});params[unit]=unit.match(/^days?/)?1:0;return recognized?this.set(params,true):this;},'clone':function(){var d=new date(this.getTime());d.utc(this.isUTC());return d;}});date.extend({'iso':function(){return this.toISOString();},'getWeekday':date.prototype.getDay,'getUTCWeekday':date.prototype.getUTCDay});function buildNumberToDateAlias(u,multiplier){var unit=u.unit,methods={};function base(){return round(this*multiplier);}
function after(){return createDate(arguments)[u.addMethod](this);}
function before(){return createDate(arguments)[u.addMethod](-this);}
methods[unit]=base;methods[unit+'s']=base;methods[unit+'Before']=before;methods[unit+'sBefore']=before;methods[unit+'Ago']=before;methods[unit+'sAgo']=before;methods[unit+'After']=after;methods[unit+'sAfter']=after;methods[unit+'FromNow']=after;methods[unit+'sFromNow']=after;number.extend(methods);}
number.extend({'duration':function(localeCode){return getLocalization(localeCode).getDuration(this);}});English=CurrentLocalization=date.addLocale('en',{'plural':true,'timeMarker':'at','ampm':'am,pm','months':'January,February,March,April,May,June,July,August,September,October,November,December','weekdays':'Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday','units':'millisecond:|s,second:|s,minute:|s,hour:|s,day:|s,week:|s,month:|s,year:|s','numbers':'one,two,three,four,five,six,seven,eight,nine,ten','articles':'a,an,the','tokens':'the,st|nd|rd|th,of','short':'{Month} {d}, {yyyy}','long':'{Month} {d}, {yyyy} {h}:{mm}{tt}','full':'{Weekday} {Month} {d}, {yyyy} {h}:{mm}:{ss}{tt}','past':'{num} {unit} {sign}','future':'{num} {unit} {sign}','duration':'{num} {unit}','modifiers':[{'name':'day','src':'yesterday','value':-1},{'name':'day','src':'today','value':0},{'name':'day','src':'tomorrow','value':1},{'name':'sign','src':'ago|before','value':-1},{'name':'sign','src':'from now|after|from|in|later','value':1},{'name':'edge','src':'last day','value':-2},{'name':'edge','src':'end','value':-1},{'name':'edge','src':'first day|beginning','value':1},{'name':'shift','src':'last','value':-1},{'name':'shift','src':'the|this','value':0},{'name':'shift','src':'next','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{month} {year}','{shift} {unit=5-7}','{0?} {date}{1}','{0?} {edge} of {shift?} {unit=4-7?}{month?}{year?}'],'timeParse':['{0} {num}{1} {day} of {month} {year?}','{weekday?} {month} {date}{1?} {year?}','{date} {month} {year}','{date} {month}','{shift} {weekday}','{shift} week {weekday}','{weekday} {2?} {shift} week','{num} {unit=4-5} {sign} {day}','{0?} {date}{1} of {month}','{0?}{month?} {date?}{1?} of {shift} {unit=6-7}']});buildDateUnits();buildDateMethods();buildCoreInputFormats();buildDateOutputShortcuts();buildAsianDigits();buildRelativeAliases();buildUTCAliases();setDateProperties();var DateRange=function(start,end){this.start=date.create(start);this.end=date.create(end);};DateRange.prototype.toString=function(){return this.isValid()?this.start.full()+'..'+this.end.full():'Invalid DateRange';};extend(DateRange,true,false,{'isValid':function(){return this.start<this.end;},'duration':function(){return this.isValid()?this.end.getTime()-this.start.getTime():NaN;},'contains':function(obj){var self=this,arr=obj.start&&obj.end?[obj.start,obj.end]:[obj];return arr.every(function(d){return d>=self.start&&d<=self.end;});},'every':function(increment,fn){var current=this.start.clone(),result=[],index=0,params,isDay;if(isString(increment)){current.advance(getDateParamsFromString(increment,0),true);params=getDateParamsFromString(increment);isDay=increment.toLowerCase()==='day';}else{params={'milliseconds':increment};}
while(current<=this.end){result.push(current);if(fn)fn(current,index);if(isDay&&callDateGet(current,'Hours')===23){current=current.clone();callDateSet(current,'Hours',48);}else{current=current.clone().advance(params,true);}
index++;}
return result;},'union':function(range){return new DateRange(this.start<range.start?this.start:range.start,this.end>range.end?this.end:range.end);},'intersect':function(range){return new DateRange(this.start>range.start?this.start:range.start,this.end<range.end?this.end:range.end);},'clone':function(range){return new DateRange(this.start,this.end);}});extendSimilar(DateRange,true,false,'Millisecond,Second,Minute,Hour,Day,Week,Month,Year',function(methods,name){methods['each'+name]=function(fn){return this.every(name,fn);}});extend(date,false,false,{'range':function(start,end){return new DateRange(start,end);}});function setDelay(fn,ms,after,scope,args){var index;if(!fn.timers)fn.timers=[];if(!isNumber(ms))ms=0;fn.timers.push(setTimeout(function(){fn.timers.splice(index,1);after.apply(scope,args||[]);},ms));index=fn.timers.length;}
extend(Function,true,false,{'lazy':function(ms,limit){var fn=this,queue=[],lock=false,execute,rounded,perExecution;ms=ms||1;limit=limit||Infinity;rounded=ceil(ms);perExecution=round(rounded/ms);execute=function(){if(lock||queue.length==0)return;var max=math.max(queue.length-perExecution,0);while(queue.length>max){Function.prototype.apply.apply(fn,queue.shift());}
setDelay(lazy,rounded,function(){lock=false;execute();});lock=true;}
function lazy(){if(lock&&queue.length>limit-2)return;queue.push([this,arguments]);execute();}
return lazy;},'delay':function(ms){var fn=this;var args=multiArgs(arguments).slice(1);setDelay(fn,ms,fn,fn,args);return fn;},'throttle':function(ms){return this.lazy(ms,1);},'debounce':function(ms){var fn=this;function debounced(){debounced.cancel();setDelay(debounced,ms,fn,this,arguments);};return debounced;},'cancel':function(){if(isArray(this.timers)){while(this.timers.length>0){clearTimeout(this.timers.shift());}}
return this;},'after':function(num){var fn=this,counter=0,storedArguments=[];if(!isNumber(num)){num=1;}else if(num===0){fn.call();return fn;}
return function(){var ret;storedArguments.push(multiArgs(arguments));counter++;if(counter==num){ret=fn.call(this,storedArguments);counter=0;storedArguments=[];return ret;}}},'once':function(){var fn=this;return function(){return hasOwnProperty(fn,'memo')?fn['memo']:fn['memo']=fn.apply(this,arguments);}},'fill':function(){var fn=this,curried=multiArgs(arguments);return function(){var args=multiArgs(arguments);curried.forEach(function(arg,index){if(arg!=null||index>=args.length)args.splice(index,0,arg);});return fn.apply(this,args);}}});function abbreviateNumber(num,roundTo,str,mid,limit,bytes){var fixed=num.toFixed(20),decimalPlace=fixed.search(/\./),numeralPlace=fixed.search(/[1-9]/),significant=decimalPlace-numeralPlace,unit,i,divisor;if(significant>0){significant-=1;}
i=math.max(math.min((significant/3).floor(),limit===false?str.length:limit),-mid);unit=str.charAt(i+mid-1);if(significant<-9){i=-3;roundTo=significant.abs()-9;unit=str.slice(0,1);}
divisor=bytes?(2).pow(10*i):(10).pow(i*3);return(num/divisor).round(roundTo||0).format()+unit.trim();}
extend(number,false,false,{'random':function(n1,n2){var min,max;if(arguments.length==1)n2=n1,n1=0;min=math.min(n1||0,isUndefined(n2)?1:n2);max=math.max(n1||0,isUndefined(n2)?1:n2)+1;return floor((math.random()*(max-min))+min);}});extend(number,true,false,{'log':function(base){return math.log(this)/(base?math.log(base):1);},'abbr':function(precision){return abbreviateNumber(this,precision,'kmbt',0,4);},'metric':function(precision,limit){return abbreviateNumber(this,precision,'nμm kMGTPE',4,isUndefined(limit)?1:limit);},'bytes':function(precision,limit){return abbreviateNumber(this,precision,'kMGTPE',0,isUndefined(limit)?4:limit,true)+'B';},'isInteger':function(){return this%1==0;},'isOdd':function(){return!isNaN(this)&&!this.isMultipleOf(2);},'isEven':function(){return this.isMultipleOf(2);},'isMultipleOf':function(num){return this%num===0;},'format':function(place,thousands,decimal){var i,str,split,integer,fraction,result='';if(isUndefined(thousands)){thousands=',';}
if(isUndefined(decimal)){decimal='.';}
str=(isNumber(place)?round(this,place||0).toFixed(math.max(place,0)):this.toString()).replace(/^-/,'');split=str.split('.');integer=split[0];fraction=split[1];for(i=integer.length;i>0;i-=3){if(i<integer.length){result=thousands+result;}
result=integer.slice(math.max(0,i-3),i)+result;}
if(fraction){result+=decimal+repeatString((place||0)-fraction.length,'0')+fraction;}
return(this<0?'-':'')+result;},'hex':function(pad){return this.pad(pad||1,false,16);},'upto':function(num,fn,step){return getRange(this,num,fn,step||1);},'downto':function(num,fn,step){return getRange(this,num,fn,-(step||1));},'times':function(fn){if(fn){for(var i=0;i<this;i++){fn.call(this,i);}}
return this.toNumber();},'chr':function(){return string.fromCharCode(this);},'pad':function(place,sign,base){return padNumber(this,place,sign,base);},'ordinalize':function(){var suffix,num=this.abs(),last=parseInt(num.toString().slice(-2));return this+getOrdinalizedSuffix(last);},'toNumber':function(){return parseFloat(this,10);}});function buildNumber(){extendSimilar(number,true,false,'round,floor,ceil',function(methods,name){methods[name]=function(precision){return round(this,precision,name);}});extendSimilar(number,true,false,'abs,pow,sin,asin,cos,acos,tan,atan,exp,pow,sqrt',function(methods,name){methods[name]=function(a,b){return math[name](this,a,b);}});}
buildNumber();var ObjectTypeMethods='isObject,isNaN'.split(',');var ObjectHashMethods='keys,values,select,reject,each,merge,clone,equal,watch,tap,has'.split(',');function setParamsObject(obj,param,value,deep){var reg=/^(.+?)(\[.*\])$/,paramIsArray,match,allKeys,key;if(deep!==false&&(match=param.match(reg))){key=match[1];allKeys=match[2].replace(/^\[|\]$/g,'').split('][');allKeys.forEach(function(k){paramIsArray=!k||k.match(/^\d+$/);if(!key&&isArray(obj))key=obj.length;if(!hasOwnProperty(obj,key)){obj[key]=paramIsArray?[]:{};}
obj=obj[key];key=k;});if(!key&&paramIsArray)key=obj.length.toString();setParamsObject(obj,key,value);}else if(value.match(/^[+-]?\d+(\.\d+)?$/)){obj[param]=parseFloat(value);}else if(value==='true'){obj[param]=true;}else if(value==='false'){obj[param]=false;}else{obj[param]=value;}}
function matchKey(key,match){if(isRegExp(match)){return match.test(key);}else if(isObjectPrimitive(match)){return hasOwnProperty(match,key);}else{return key===string(match);}}
function selectFromObject(obj,args,select){var result={},match;iterateOverObject(obj,function(key,value){match=false;flattenedArgs(args,function(arg){if(matchKey(key,arg)){match=true;}},1);if(match===select){result[key]=value;}});return result;}
function buildTypeMethods(){extendSimilar(object,false,false,ClassNames,function(methods,name){var method='is'+name;ObjectTypeMethods.push(method);methods[method]=function(obj){return className(obj)==='[object '+name+']';}});}
function buildObjectExtend(){extend(object,false,function(){return arguments.length===0;},{'extend':function(){var methods=ObjectTypeMethods.concat(ObjectHashMethods)
if(typeof EnumerableMethods!=='undefined'){methods=methods.concat(EnumerableMethods);}
buildObjectInstanceMethods(methods,object);}});}
extend(object,false,true,{'watch':function(obj,prop,fn){if(!definePropertySupport)return;var value=obj[prop];object.defineProperty(obj,prop,{'enumerable':true,'configurable':true,'get':function(){return value;},'set':function(to){value=fn.call(obj,prop,value,to);}});}});extend(object,false,function(arg1,arg2){return isFunction(arg2);},{'keys':function(obj,fn){var keys=object.keys(obj);keys.forEach(function(key){fn.call(obj,key,obj[key]);});return keys;}});extend(object,false,false,{'isObject':function(obj){return isObject(obj);},'isNaN':function(obj){return isNumber(obj)&&obj.valueOf()!==obj.valueOf();},'equal':function(a,b){return isEqual(a,b);},'extended':function(obj){return new Hash(obj);},'merge':function(target,source,deep,resolve){var key,val;if(target&&typeof source!='string'){for(key in source){if(!hasOwnProperty(source,key)||!target)continue;val=source[key];if(isDefined(target[key])){if(resolve===false){continue;}
if(isFunction(resolve)){val=resolve.call(source,key,target[key],source[key])}}
if(deep===true&&val&&isObjectPrimitive(val)){if(isDate(val)){val=new date(val.getTime());}else if(isRegExp(val)){val=new regexp(val.source,getRegExpFlags(val));}else{if(!target[key])target[key]=array.isArray(val)?[]:{};object.merge(target[key],source[key],deep,resolve);continue;}}
target[key]=val;}}
return target;},'values':function(obj,fn){var values=[];iterateOverObject(obj,function(k,v){values.push(v);if(fn)fn.call(obj,v);});return values;},'clone':function(obj,deep){var target;if(!isObjectPrimitive(obj))return obj;if(obj instanceof Hash){target=new Hash;}else{target=new obj.constructor;}
return object.merge(target,obj,deep);},'fromQueryString':function(str,deep){var result=object.extended(),split;str=str&&str.toString?str.toString():'';str.replace(/^.*?\?/,'').split('&').forEach(function(p){var split=p.split('=');if(split.length!==2)return;setParamsObject(result,split[0],decodeURIComponent(split[1]),deep);});return result;},'tap':function(obj,arg){var fn=arg;if(!isFunction(arg)){fn=function(){if(arg)obj[arg]();}}
fn.call(obj,obj);return obj;},'has':function(obj,key){return hasOwnProperty(obj,key);},'select':function(obj){return selectFromObject(obj,arguments,true);},'reject':function(obj){return selectFromObject(obj,arguments,false);}});buildTypeMethods();buildObjectExtend();buildObjectInstanceMethods(ObjectHashMethods,Hash);function uniqueRegExpFlags(flags){return flags.split('').sort().join('').replace(/([gimy])\1+/g,'$1');}
extend(regexp,false,false,{'escape':function(str){return escapeRegExp(str);}});extend(regexp,true,false,{'getFlags':function(){return getRegExpFlags(this);},'setFlags':function(flags){return regexp(this.source,flags);},'addFlag':function(flag){return this.setFlags(getRegExpFlags(this,flag));},'removeFlag':function(flag){return this.setFlags(getRegExpFlags(this).replace(flag,''));}});function getAcronym(word){var inflector=string.Inflector;var word=inflector&&inflector.acronyms[word];if(isString(word)){return word;}}
function padString(str,p,left,right){var padding=string(p);if(padding!=p){padding='';}
if(!isNumber(left))left=1;if(!isNumber(right))right=1;return padding.repeat(left)+str+padding.repeat(right);}
function chr(num){return string.fromCharCode(num);}
var btoa,atob;function buildBase64(key){if(this.btoa){btoa=this.btoa;atob=this.atob;return;}
var base64reg=/[^A-Za-z0-9\+\/\=]/g;btoa=function(str){var output='';var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;do{chr1=str.charCodeAt(i++);chr2=str.charCodeAt(i++);chr3=str.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+key.charAt(enc1)+key.charAt(enc2)+key.charAt(enc3)+key.charAt(enc4);chr1=chr2=chr3='';enc1=enc2=enc3=enc4='';}while(i<str.length);return output;}
atob=function(input){var output='';var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;if(input.match(base64reg)){throw new Error('String contains invalid base64 characters');}
input=input.replace(/[^A-Za-z0-9\+\/\=]/g,'');do{enc1=key.indexOf(input.charAt(i++));enc2=key.indexOf(input.charAt(i++));enc3=key.indexOf(input.charAt(i++));enc4=key.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+chr(chr1);if(enc3!=64){output=output+chr(chr2);}
if(enc4!=64){output=output+chr(chr3);}
chr1=chr2=chr3='';enc1=enc2=enc3=enc4='';}while(i<input.length);return output;}}
extend(string,true,function(reg){return isRegExp(reg)||arguments.length>2;},{'startsWith':function(reg,pos,c){var str=this,source;if(pos)str=str.slice(pos);if(isUndefined(c))c=true;source=isRegExp(reg)?reg.source.replace('^',''):escapeRegExp(reg);return regexp('^'+source,c?'':'i').test(str);},'endsWith':function(reg,pos,c){var str=this,source;if(isDefined(pos))str=str.slice(0,pos);if(isUndefined(c))c=true;source=isRegExp(reg)?reg.source.replace('$',''):escapeRegExp(reg);return regexp(source+'$',c?'':'i').test(str);}});extend(string,true,false,{'escapeRegExp':function(){return escapeRegExp(this);},'escapeURL':function(param){return param?encodeURIComponent(this):encodeURI(this);},'unescapeURL':function(param){return param?decodeURI(this):decodeURIComponent(this);},'escapeHTML':function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&apos;').replace(/\//g,'&#x2f;');},'unescapeHTML':function(){return this.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#x2f;/g,'/');},'encodeBase64':function(){return btoa(this);},'decodeBase64':function(){return atob(this);},'each':function(search,fn){var match,i;if(isFunction(search)){fn=search;search=/[\s\S]/g;}else if(!search){search=/[\s\S]/g}else if(isString(search)){search=regexp(escapeRegExp(search),'gi');}else if(isRegExp(search)){search=regexp(search.source,getRegExpFlags(search,'g'));}
match=this.match(search)||[];if(fn){for(i=0;i<match.length;i++){match[i]=fn.call(this,match[i],i,match)||match[i];}}
return match;},'shift':function(n){var result='';n=n||0;this.codes(function(c){result+=chr(c+n);});return result;},'codes':function(fn){var codes=[];for(var i=0;i<this.length;i++){var code=this.charCodeAt(i);codes.push(code);if(fn)fn.call(this,code,i);}
return codes;},'chars':function(fn){return this.each(fn);},'words':function(fn){return this.trim().each(/\S+/g,fn);},'lines':function(fn){return this.trim().each(/^.*$/gm,fn);},'paragraphs':function(fn){var paragraphs=this.trim().split(/[\r\n]{2,}/);paragraphs=paragraphs.map(function(p){if(fn)var s=fn.call(p);return s?s:p;});return paragraphs;},'isBlank':function(){return this.trim().length===0;},'has':function(find){return this.search(isRegExp(find)?find:escapeRegExp(find))!==-1;},'add':function(str,index){index=isUndefined(index)?this.length:index;return this.slice(0,index)+str+this.slice(index);},'remove':function(f){return this.replace(f,'');},'reverse':function(){return this.split('').reverse().join('');},'compact':function(){return this.trim().replace(/([\r\n\s　])+/g,function(match,whitespace){return whitespace==='　'?whitespace:' ';});},'at':function(){return entryAtIndex(this,arguments,true);},'from':function(num){return this.slice(num);},'to':function(num){if(isUndefined(num))num=this.length;return this.slice(0,num);},'dasherize':function(){return this.underscore().replace(/_/g,'-');},'underscore':function(){return this.replace(/[-\s]+/g,'_').replace(string.Inflector&&string.Inflector.acronymRegExp,function(acronym,index){return(index>0?'_':'')+acronym.toLowerCase();}).replace(/([A-Z\d]+)([A-Z][a-z])/g,'$1_$2').replace(/([a-z\d])([A-Z])/g,'$1_$2').toLowerCase();},'camelize':function(first){return this.underscore().replace(/(^|_)([^_]+)/g,function(match,pre,word,index){var acronym=getAcronym(word),capitalize=first!==false||index>0;if(acronym)return capitalize?acronym:acronym.toLowerCase();return capitalize?word.capitalize():word;});},'spacify':function(){return this.underscore().replace(/_/g,' ');},'stripTags':function(){var str=this,args=arguments.length>0?arguments:[''];flattenedArgs(args,function(tag){str=str.replace(regexp('<\/?'+escapeRegExp(tag)+'[^<>]*>','gi'),'');});return str;},'removeTags':function(){var str=this,args=arguments.length>0?arguments:['\\S+'];flattenedArgs(args,function(t){var reg=regexp('<('+t+')[^<>]*(?:\\/>|>.*?<\\/\\1>)','gi');str=str.replace(reg,'');});return str;},'truncate':function(length,split,from,ellipsis){var pos,prepend='',append='',str=this.toString(),chars='['+getTrimmableCharacters()+']+',space='[^'+getTrimmableCharacters()+']*',reg=regexp(chars+space+'$');ellipsis=isUndefined(ellipsis)?'...':string(ellipsis);if(str.length<=length){return str;}
switch(from){case'left':pos=str.length-length;prepend=ellipsis;str=str.slice(pos);reg=regexp('^'+space+chars);break;case'middle':pos=floor(length/2);append=ellipsis+str.slice(str.length-pos).trimLeft();str=str.slice(0,pos);break;default:pos=length;append=ellipsis;str=str.slice(0,pos);}
if(split===false&&this.slice(pos,pos+1).match(/\S/)){str=str.remove(reg);}
return prepend+str+append;},'pad':function(padding,num){return repeatString(num,padding)+this+repeatString(num,padding);},'padLeft':function(padding,num){return repeatString(num,padding)+this;},'padRight':function(padding,num){return this+repeatString(num,padding);},'first':function(num){if(isUndefined(num))num=1;return this.substr(0,num);},'last':function(num){if(isUndefined(num))num=1;var start=this.length-num<0?0:this.length-num;return this.substr(start);},'repeat':function(num){var result='',str=this;if(!isNumber(num)||num<1)return'';while(num){if(num&1){result+=str;}
if(num>>=1){str+=str;}}
return result;},'toNumber':function(base){var str=this.replace(/,/g,'');return str.match(/\./)?parseFloat(str):parseInt(str,base||10);},'capitalize':function(all){var lastResponded;return this.toLowerCase().replace(all?/[\s\S]/g:/^\S/,function(lower){var upper=lower.toUpperCase(),result;result=lastResponded?lower:upper;lastResponded=upper!==lower;return result;});},'assign':function(){var assign={};multiArgs(arguments,function(a,i){if(isObject(a)){simpleMerge(assign,a);}else{assign[i+1]=a;}});return this.replace(/\{([^{]+?)\}/g,function(m,key){return hasOwnProperty(assign,key)?assign[key]:m;});},'namespace':function(context){context=context||globalContext;iterateOverObject(this.split('.'),function(i,s){return!!(context=context[s]);});return context;}});extend(string,true,false,{'insert':string.prototype.add});buildBase64('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=');var plurals=[],singulars=[],uncountables=[],humans=[],acronyms={},Downcased,Inflector;function removeFromArray(arr,find){var index=arr.indexOf(find);if(index>-1){arr.splice(index,1);}}
function removeFromUncountablesAndAddTo(arr,rule,replacement){if(isString(rule)){removeFromArray(uncountables,rule);}
removeFromArray(uncountables,replacement);arr.unshift({rule:rule,replacement:replacement})}
function paramMatchesType(param,type){return param==type||param=='all'||!param;}
function isUncountable(word){return uncountables.some(function(uncountable){return new regexp('\\b'+uncountable+'$','i').test(word);});}
function inflect(word,pluralize){word=isString(word)?word.toString():'';if(word.isBlank()||isUncountable(word)){return word;}else{return runReplacements(word,pluralize?plurals:singulars);}}
function runReplacements(word,table){iterateOverObject(table,function(i,inflection){if(word.match(inflection.rule)){word=word.replace(inflection.rule,inflection.replacement);return false;}});return word;}
function capitalize(word){return word.replace(/^\W*[a-z]/,function(w){return w.toUpperCase();});}
Inflector={'acronym':function(word){acronyms[word.toLowerCase()]=word;var all=object.keys(acronyms).map(function(key){return acronyms[key];});Inflector.acronymRegExp=regexp(all.join('|'),'g');},'plural':function(rule,replacement){removeFromUncountablesAndAddTo(plurals,rule,replacement);},'singular':function(rule,replacement){removeFromUncountablesAndAddTo(singulars,rule,replacement);},'irregular':function(singular,plural){var singularFirst=singular.first(),singularRest=singular.from(1),pluralFirst=plural.first(),pluralRest=plural.from(1),pluralFirstUpper=pluralFirst.toUpperCase(),pluralFirstLower=pluralFirst.toLowerCase(),singularFirstUpper=singularFirst.toUpperCase(),singularFirstLower=singularFirst.toLowerCase();removeFromArray(uncountables,singular);removeFromArray(uncountables,plural);if(singularFirstUpper==pluralFirstUpper){Inflector.plural(new regexp('({1}){2}$'.assign(singularFirst,singularRest),'i'),'$1'+pluralRest);Inflector.plural(new regexp('({1}){2}$'.assign(pluralFirst,pluralRest),'i'),'$1'+pluralRest);Inflector.singular(new regexp('({1}){2}$'.assign(pluralFirst,pluralRest),'i'),'$1'+singularRest);}else{Inflector.plural(new regexp('{1}{2}$'.assign(singularFirstUpper,singularRest)),pluralFirstUpper+pluralRest);Inflector.plural(new regexp('{1}{2}$'.assign(singularFirstLower,singularRest)),pluralFirstLower+pluralRest);Inflector.plural(new regexp('{1}{2}$'.assign(pluralFirstUpper,pluralRest)),pluralFirstUpper+pluralRest);Inflector.plural(new regexp('{1}{2}$'.assign(pluralFirstLower,pluralRest)),pluralFirstLower+pluralRest);Inflector.singular(new regexp('{1}{2}$'.assign(pluralFirstUpper,pluralRest)),singularFirstUpper+singularRest);Inflector.singular(new regexp('{1}{2}$'.assign(pluralFirstLower,pluralRest)),singularFirstLower+singularRest);}},'uncountable':function(first){var add=array.isArray(first)?first:multiArgs(arguments);uncountables=uncountables.concat(add);},'human':function(rule,replacement){humans.unshift({rule:rule,replacement:replacement})},'clear':function(type){if(paramMatchesType(type,'singulars'))singulars=[];if(paramMatchesType(type,'plurals'))plurals=[];if(paramMatchesType(type,'uncountables'))uncountables=[];if(paramMatchesType(type,'humans'))humans=[];if(paramMatchesType(type,'acronyms'))acronyms={};}};Downcased=['and','or','nor','a','an','the','so','but','to','of','at','by','from','into','on','onto','off','out','in','over','with','for'];Inflector.plural(/$/,'s');Inflector.plural(/s$/gi,'s');Inflector.plural(/(ax|test)is$/gi,'$1es');Inflector.plural(/(octop|vir|fung|foc|radi|alumn)(i|us)$/gi,'$1i');Inflector.plural(/(census|alias|status)$/gi,'$1es');Inflector.plural(/(bu)s$/gi,'$1ses');Inflector.plural(/(buffal|tomat)o$/gi,'$1oes');Inflector.plural(/([ti])um$/gi,'$1a');Inflector.plural(/([ti])a$/gi,'$1a');Inflector.plural(/sis$/gi,'ses');Inflector.plural(/f+e?$/gi,'ves');Inflector.plural(/(cuff|roof)$/gi,'$1s');Inflector.plural(/([ht]ive)$/gi,'$1s');Inflector.plural(/([^aeiouy]o)$/gi,'$1es');Inflector.plural(/([^aeiouy]|qu)y$/gi,'$1ies');Inflector.plural(/(x|ch|ss|sh)$/gi,'$1es');Inflector.plural(/(matr|vert|ind)(?:ix|ex)$/gi,'$1ices');Inflector.plural(/([ml])ouse$/gi,'$1ice');Inflector.plural(/([ml])ice$/gi,'$1ice');Inflector.plural(/^(ox)$/gi,'$1en');Inflector.plural(/^(oxen)$/gi,'$1');Inflector.plural(/(quiz)$/gi,'$1zes');Inflector.plural(/(phot|cant|hom|zer|pian|portic|pr|quart|kimon)o$/gi,'$1os');Inflector.plural(/(craft)$/gi,'$1');Inflector.plural(/([ft])[eo]{2}(th?)$/gi,'$1ee$2');Inflector.singular(/s$/gi,'');Inflector.singular(/([pst][aiu]s)$/gi,'$1');Inflector.singular(/([aeiouy])ss$/gi,'$1ss');Inflector.singular(/(n)ews$/gi,'$1ews');Inflector.singular(/([ti])a$/gi,'$1um');Inflector.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/gi,'$1$2sis');Inflector.singular(/(^analy)ses$/gi,'$1sis');Inflector.singular(/(i)(f|ves)$/i,'$1fe');Inflector.singular(/([aeolr]f?)(f|ves)$/i,'$1f');Inflector.singular(/([ht]ive)s$/gi,'$1');Inflector.singular(/([^aeiouy]|qu)ies$/gi,'$1y');Inflector.singular(/(s)eries$/gi,'$1eries');Inflector.singular(/(m)ovies$/gi,'$1ovie');Inflector.singular(/(x|ch|ss|sh)es$/gi,'$1');Inflector.singular(/([ml])(ous|ic)e$/gi,'$1ouse');Inflector.singular(/(bus)(es)?$/gi,'$1');Inflector.singular(/(o)es$/gi,'$1');Inflector.singular(/(shoe)s?$/gi,'$1');Inflector.singular(/(cris|ax|test)[ie]s$/gi,'$1is');Inflector.singular(/(octop|vir|fung|foc|radi|alumn)(i|us)$/gi,'$1us');Inflector.singular(/(census|alias|status)(es)?$/gi,'$1');Inflector.singular(/^(ox)(en)?/gi,'$1');Inflector.singular(/(vert|ind)(ex|ices)$/gi,'$1ex');Inflector.singular(/(matr)(ix|ices)$/gi,'$1ix');Inflector.singular(/(quiz)(zes)?$/gi,'$1');Inflector.singular(/(database)s?$/gi,'$1');Inflector.singular(/ee(th?)$/gi,'oo$1');Inflector.irregular('person','people');Inflector.irregular('man','men');Inflector.irregular('child','children');Inflector.irregular('sex','sexes');Inflector.irregular('move','moves');Inflector.irregular('save','saves');Inflector.irregular('save','saves');Inflector.irregular('cow','kine');Inflector.irregular('goose','geese');Inflector.irregular('zombie','zombies');Inflector.uncountable('equipment,information,rice,money,species,series,fish,sheep,jeans'.split(','));extend(string,true,false,{'pluralize':function(){return inflect(this,true);},'singularize':function(){return inflect(this,false);},'humanize':function(){var str=runReplacements(this,humans),acronym;str=str.replace(/_id$/g,'');str=str.replace(/(_)?([a-z\d]*)/gi,function(match,_,word){acronym=hasOwnProperty(acronyms,word)?acronyms[word]:null;return(_?' ':'')+(acronym||word.toLowerCase());});return capitalize(str);},'titleize':function(){var fullStopPunctuation=/[.:;!]$/,hasPunctuation,lastHadPunctuation,isFirstOrLast;return this.spacify().humanize().words(function(word,index,words){hasPunctuation=fullStopPunctuation.test(word);isFirstOrLast=index==0||index==words.length-1||hasPunctuation||lastHadPunctuation;lastHadPunctuation=hasPunctuation;if(isFirstOrLast||Downcased.indexOf(word)===-1){return capitalize(word);}else{return word;}}).join(' ');},'parameterize':function(separator){var str=this;if(separator===undefined)separator='-';if(str.normalize){str=str.normalize();}
str=str.replace(/[^a-z0-9\-_]+/gi,separator)
if(separator){str=str.replace(new regexp('^{sep}+|{sep}+$|({sep}){sep}+'.assign({'sep':escapeRegExp(separator)}),'g'),'$1');}
return encodeURI(str.toLowerCase());}});string.Inflector=Inflector;string.Inflector.acronyms=acronyms;var NormalizeMap,NormalizeReg='',NormalizeSource;var unicodeScripts=[{names:['Arabic'],source:'\u0600-\u06FF'},{names:['Cyrillic'],source:'\u0400-\u04FF'},{names:['Devanagari'],source:'\u0900-\u097F'},{names:['Greek'],source:'\u0370-\u03FF'},{names:['Hangul'],source:'\uAC00-\uD7AF\u1100-\u11FF'},{names:['Han','Kanji'],source:'\u4E00-\u9FFF\uF900-\uFAFF'},{names:['Hebrew'],source:'\u0590-\u05FF'},{names:['Hiragana'],source:'\u3040-\u309F\u30FB-\u30FC'},{names:['Kana'],source:'\u3040-\u30FF\uFF61-\uFF9F'},{names:['Katakana'],source:'\u30A0-\u30FF\uFF61-\uFF9F'},{names:['Latin'],source:'\u0001-\u007F\u0080-\u00FF\u0100-\u017F\u0180-\u024F'},{names:['Thai'],source:'\u0E00-\u0E7F'}];function buildUnicodeScripts(){unicodeScripts.forEach(function(s){var is=regexp('^['+s.source+'\\s]+$');var has=regexp('['+s.source+']');s.names.forEach(function(name){defineProperty(string.prototype,'is'+name,function(){return is.test(this.trim());});defineProperty(string.prototype,'has'+name,function(){return has.test(this);});});});}
var widthConversionRanges=[{type:'a',shift:65248,start:65,end:90},{type:'a',shift:65248,start:97,end:122},{type:'n',shift:65248,start:48,end:57},{type:'p',shift:65248,start:33,end:47},{type:'p',shift:65248,start:58,end:64},{type:'p',shift:65248,start:91,end:96},{type:'p',shift:65248,start:123,end:126}];var WidthConversionTable;var allHankaku=/[\u0020-\u00A5]|[\uFF61-\uFF9F][ﾞﾟ]?/g;var allZenkaku=/[\u3000-\u301C]|[\u301A-\u30FC]|[\uFF01-\uFF60]|[\uFFE0-\uFFE6]/g;var hankakuPunctuation='｡､｢｣¥¢£';var zenkakuPunctuation='。、「」￥￠￡';var voicedKatakana=/[カキクケコサシスセソタチツテトハヒフヘホ]/;var semiVoicedKatakana=/[ハヒフヘホヲ]/;var hankakuKatakana='ｱｲｳｴｵｧｨｩｪｫｶｷｸｹｺｻｼｽｾｿﾀﾁﾂｯﾃﾄﾅﾆﾇﾈﾉﾊﾋﾌﾍﾎﾏﾐﾑﾒﾓﾔｬﾕｭﾖｮﾗﾘﾙﾚﾛﾜｦﾝｰ･';var zenkakuKatakana='アイウエオァィゥェォカキクケコサシスセソタチツッテトナニヌネノハヒフヘホマミムメモヤャユュヨョラリルレロワヲンー・';function convertCharacterWidth(str,args,reg,type){if(!WidthConversionTable){buildWidthConversionTables();}
var mode=multiArgs(args).join(''),table=WidthConversionTable[type];mode=mode.replace(/all/,'').replace(/(\w)lphabet|umbers?|atakana|paces?|unctuation/g,'$1');return str.replace(reg,function(c){if(table[c]&&(!mode||mode.has(table[c].type))){return table[c].to;}else{return c;}});}
function buildWidthConversionTables(){var hankaku;WidthConversionTable={'zenkaku':{},'hankaku':{}};widthConversionRanges.forEach(function(r){getRange(r.start,r.end,function(n){setWidthConversion(r.type,chr(n),chr(n+r.shift));});});zenkakuKatakana.each(function(c,i){hankaku=hankakuKatakana.charAt(i);setWidthConversion('k',hankaku,c);if(c.match(voicedKatakana)){setWidthConversion('k',hankaku+'ﾞ',c.shift(1));}
if(c.match(semiVoicedKatakana)){setWidthConversion('k',hankaku+'ﾟ',c.shift(2));}});zenkakuPunctuation.each(function(c,i){setWidthConversion('p',hankakuPunctuation.charAt(i),c);});setWidthConversion('k','ｳﾞ','ヴ');setWidthConversion('k','ｦﾞ','ヺ');setWidthConversion('s',' ','　');}
function setWidthConversion(type,half,full){WidthConversionTable['zenkaku'][half]={type:type,to:full};WidthConversionTable['hankaku'][full]={type:type,to:half};}
function buildNormalizeMap(){NormalizeMap={};iterateOverObject(NormalizeSource,function(normalized,str){str.split('').forEach(function(character){NormalizeMap[character]=normalized;});NormalizeReg+=str;});NormalizeReg=regexp('['+NormalizeReg+']','g');}
NormalizeSource={'A':'AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ','B':'BⒷＢḂḄḆɃƂƁ','C':'CⒸＣĆĈĊČÇḈƇȻꜾ','D':'DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ','E':'EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ','F':'FⒻＦḞƑꝻ','G':'GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ','H':'HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ','I':'IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ','J':'JⒿＪĴɈ','K':'KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ','L':'LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ','M':'MⓂＭḾṀṂⱮƜ','N':'NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ','O':'OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ','P':'PⓅＰṔṖƤⱣꝐꝒꝔ','Q':'QⓆＱꝖꝘɊ','R':'RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ','S':'SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ','T':'TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ','U':'UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ','V':'VⓋＶṼṾƲꝞɅ','W':'WⓌＷẀẂŴẆẄẈⱲ','X':'XⓍＸẊẌ','Y':'YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ','Z':'ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ','a':'aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ','b':'bⓑｂḃḅḇƀƃɓ','c':'cⓒｃćĉċčçḉƈȼꜿↄ','d':'dⓓｄḋďḍḑḓḏđƌɖɗꝺ','e':'eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ','f':'fⓕｆḟƒꝼ','g':'gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ','h':'hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ','i':'iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı','j':'jⓙｊĵǰɉ','k':'kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ','l':'lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ','m':'mⓜｍḿṁṃɱɯ','n':'nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ','o':'oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ','p':'pⓟｐṕṗƥᵽꝑꝓꝕ','q':'qⓠｑɋꝗꝙ','r':'rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ','s':'sⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛ','t':'tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ','u':'uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ','v':'vⓥｖṽṿʋꝟʌ','w':'wⓦｗẁẃŵẇẅẘẉⱳ','x':'xⓧｘẋẍ','y':'yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ','z':'zⓩｚźẑżžẓẕƶȥɀⱬꝣ','AA':'Ꜳ','AE':'ÆǼǢ','AO':'Ꜵ','AU':'Ꜷ','AV':'ꜸꜺ','AY':'Ꜽ','DZ':'ǱǄ','Dz':'ǲǅ','LJ':'Ǉ','Lj':'ǈ','NJ':'Ǌ','Nj':'ǋ','OI':'Ƣ','OO':'Ꝏ','OU':'Ȣ','TZ':'Ꜩ','VY':'Ꝡ','aa':'ꜳ','ae':'æǽǣ','ao':'ꜵ','au':'ꜷ','av':'ꜹꜻ','ay':'ꜽ','dz':'ǳǆ','hv':'ƕ','lj':'ǉ','nj':'ǌ','oi':'ƣ','ou':'ȣ','oo':'ꝏ','ss':'ß','tz':'ꜩ','vy':'ꝡ'};extend(string,true,false,{'normalize':function(){if(!NormalizeMap){buildNormalizeMap();}
return this.replace(NormalizeReg,function(character){return NormalizeMap[character];});},'hankaku':function(){return convertCharacterWidth(this,arguments,allZenkaku,'hankaku');},'zenkaku':function(){return convertCharacterWidth(this,arguments,allHankaku,'zenkaku');},'hiragana':function(all){var str=this;if(all!==false){str=str.zenkaku('k');}
return str.replace(/[\u30A1-\u30F6]/g,function(c){return c.shift(-96);});},'katakana':function(){return this.replace(/[\u3041-\u3096]/g,function(c){return c.shift(96);});}});buildUnicodeScripts();Date.addLocale('da',{'plural':true,'months':'januar,februar,marts,april,maj,juni,juli,august,september,oktober,november,december','weekdays':'søndag|sondag,mandag,tirsdag,onsdag,torsdag,fredag,lørdag|lordag','units':'millisekund:|er,sekund:|er,minut:|ter,tim:e|er,dag:|e,ug:e|er|en,måned:|er|en+maaned:|er|en,år:||et+aar:||et','numbers':'en|et,to,tre,fire,fem,seks,syv,otte,ni,ti','tokens':'den,for','articles':'den','short':'d. {d}. {month} {yyyy}','long':'den {d}. {month} {yyyy} {H}:{mm}','full':'{Weekday} den {d}. {month} {yyyy} {H}:{mm}:{ss}','past':'{num} {unit} {sign}','future':'{sign} {num} {unit}','duration':'{num} {unit}','ampm':'am,pm','modifiers':[{'name':'day','src':'forgårs|i forgårs|forgaars|i forgaars','value':-2},{'name':'day','src':'i går|igår|i gaar|igaar','value':-1},{'name':'day','src':'i dag|idag','value':0},{'name':'day','src':'i morgen|imorgen','value':1},{'name':'day','src':'over morgon|overmorgen|i over morgen|i overmorgen|iovermorgen','value':2},{'name':'sign','src':'siden','value':-1},{'name':'sign','src':'om','value':1},{'name':'shift','src':'i sidste|sidste','value':-1},{'name':'shift','src':'denne','value':0},{'name':'shift','src':'næste|naeste','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{1?} {num} {unit} {sign}','{shift} {unit=5-7}'],'timeParse':['{0?} {weekday?} {date?} {month} {year}','{date} {month}','{shift} {weekday}']});Date.addLocale('de',{'plural':true,'capitalizeUnit':true,'months':'Januar,Februar,März|Marz,April,Mai,Juni,Juli,August,September,Oktober,November,Dezember','weekdays':'Sonntag,Montag,Dienstag,Mittwoch,Donnerstag,Freitag,Samstag','units':'Millisekunde:|n,Sekunde:|n,Minute:|n,Stunde:|n,Tag:|en,Woche:|n,Monat:|en,Jahr:|en','numbers':'ein:|e|er|en|em,zwei,drei,vier,fuenf,sechs,sieben,acht,neun,zehn','tokens':'der','short':'{d}. {Month} {yyyy}','long':'{d}. {Month} {yyyy} {H}:{mm}','full':'{Weekday} {d}. {Month} {yyyy} {H}:{mm}:{ss}','past':'{sign} {num} {unit}','future':'{sign} {num} {unit}','duration':'{num} {unit}','timeMarker':'um','ampm':'am,pm','modifiers':[{'name':'day','src':'vorgestern','value':-2},{'name':'day','src':'gestern','value':-1},{'name':'day','src':'heute','value':0},{'name':'day','src':'morgen','value':1},{'name':'day','src':'übermorgen|ubermorgen|uebermorgen','value':2},{'name':'sign','src':'vor:|her','value':-1},{'name':'sign','src':'in','value':1},{'name':'shift','src':'letzte:|r|n|s','value':-1},{'name':'shift','src':'nächste:|r|n|s+nachste:|r|n|s+naechste:|r|n|s+kommende:n|r','value':1}],'dateParse':['{sign} {num} {unit}','{num} {unit} {sign}','{shift} {unit=5-7}'],'timeParse':['{weekday?} {date?} {month} {year?}','{shift} {weekday}']});Date.addLocale('es',{'plural':true,'months':'enero,febrero,marzo,abril,mayo,junio,julio,agosto,septiembre,octubre,noviembre,diciembre','weekdays':'domingo,lunes,martes,miércoles|miercoles,jueves,viernes,sábado|sabado','units':'milisegundo:|s,segundo:|s,minuto:|s,hora:|s,día|días|dia|dias,semana:|s,mes:|es,año|años|ano|anos','numbers':'uno,dos,tres,cuatro,cinco,seis,siete,ocho,nueve,diez','tokens':'el,de','short':'{d} {month} {yyyy}','long':'{d} {month} {yyyy} {H}:{mm}','full':'{Weekday} {d} {month} {yyyy} {H}:{mm}:{ss}','past':'{sign} {num} {unit}','future':'{num} {unit} {sign}','duration':'{num} {unit}','timeMarker':'a las','ampm':'am,pm','modifiers':[{'name':'day','src':'anteayer','value':-2},{'name':'day','src':'ayer','value':-1},{'name':'day','src':'hoy','value':0},{'name':'day','src':'mañana|manana','value':1},{'name':'sign','src':'hace','value':-1},{'name':'sign','src':'de ahora','value':1},{'name':'shift','src':'pasad:o|a','value':-1},{'name':'shift','src':'próximo|próxima|proximo|proxima','value':1}],'dateParse':['{sign} {num} {unit}','{num} {unit} {sign}','{0?} {unit=5-7} {shift}','{0?} {shift} {unit=5-7}'],'timeParse':['{shift} {weekday}','{weekday} {shift}','{date?} {1?} {month} {1?} {year?}']});Date.addLocale('fi',{'plural':true,'timeMarker':'kello','ampm':',','months':'tammikuu,helmikuu,maaliskuu,huhtikuu,toukokuu,kesäkuu,heinäkuu,elokuu,syyskuu,lokakuu,marraskuu,joulukuu','weekdays':'sunnuntai,maanantai,tiistai,keskiviikko,torstai,perjantai,lauantai','units':'millisekun:ti|tia|teja|tina|nin,sekun:ti|tia|teja|tina|nin,minuut:ti|tia|teja|tina|in,tun:ti|tia|teja|tina|nin,päiv:ä|ää|iä|änä|än,viik:ko|koa|koja|on|kona,kuukau:si|sia|tta|den|tena,vuo:si|sia|tta|den|tena','numbers':'yksi|ensimmäinen,kaksi|toinen,kolm:e|as,neljä:s,vii:si|des,kuu:si|des,seitsemä:n|s,kahdeksa:n|s,yhdeksä:n|s,kymmene:n|s','articles':'','optionals':'','short':'{d}. {month}ta {yyyy}','long':'{d}. {month}ta {yyyy} kello {H}.{mm}','full':'{Weekday}na {d}. {month}ta {yyyy} kello {H}.{mm}','relative':function(num,unit,ms,format){var units=this['units'];function numberWithUnit(mult){return(num===1?'':num+' ')+units[(8*mult)+unit];}
switch(format){case'duration':return numberWithUnit(0);case'past':return numberWithUnit(num>1?1:0)+' sitten';case'future':return numberWithUnit(4)+' päästä';}},'modifiers':[{'name':'day','src':'toissa päivänä|toissa päiväistä','value':-2},{'name':'day','src':'eilen|eilistä','value':-1},{'name':'day','src':'tänään','value':0},{'name':'day','src':'huomenna|huomista','value':1},{'name':'day','src':'ylihuomenna|ylihuomista','value':2},{'name':'sign','src':'sitten|aiemmin','value':-1},{'name':'sign','src':'päästä|kuluttua|myöhemmin','value':1},{'name':'edge','src':'viimeinen|viimeisenä','value':-2},{'name':'edge','src':'lopussa','value':-1},{'name':'edge','src':'ensimmäinen|ensimmäisenä','value':1},{'name':'shift','src':'edellinen|edellisenä|edeltävä|edeltävänä|viime|toissa','value':-1},{'name':'shift','src':'tänä|tämän','value':0},{'name':'shift','src':'seuraava|seuraavana|tuleva|tulevana|ensi','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{num} {unit=4-5} {sign} {day}','{month} {year}','{shift} {unit=5-7}'],'timeParse':['{0} {num}{1} {day} of {month} {year?}','{weekday?} {month} {date}{1} {year?}','{date} {month} {year}','{shift} {weekday}','{shift} week {weekday}','{weekday} {2} {shift} week','{0} {date}{1} of {month}','{0}{month?} {date?}{1} of {shift} {unit=6-7}']});Date.addLocale('fr',{'plural':true,'months':'janvier,février|fevrier,mars,avril,mai,juin,juillet,août,septembre,octobre,novembre,décembre|decembre','weekdays':'dimanche,lundi,mardi,mercredi,jeudi,vendredi,samedi','units':'milliseconde:|s,seconde:|s,minute:|s,heure:|s,jour:|s,semaine:|s,mois,an:|s|née|nee','numbers':'un:|e,deux,trois,quatre,cinq,six,sept,huit,neuf,dix','tokens':["l'|la|le"],'short':'{d} {month} {yyyy}','long':'{d} {month} {yyyy} {H}:{mm}','full':'{Weekday} {d} {month} {yyyy} {H}:{mm}:{ss}','past':'{sign} {num} {unit}','future':'{sign} {num} {unit}','duration':'{num} {unit}','timeMarker':'à','ampm':'am,pm','modifiers':[{'name':'day','src':'hier','value':-1},{'name':'day','src':"aujourd'hui",'value':0},{'name':'day','src':'demain','value':1},{'name':'sign','src':'il y a','value':-1},{'name':'sign','src':"dans|d'ici",'value':1},{'name':'shift','src':'derni:èr|er|ère|ere','value':-1},{'name':'shift','src':'prochain:|e','value':1}],'dateParse':['{sign} {num} {unit}','{sign} {num} {unit}','{0?} {unit=5-7} {shift}'],'timeParse':['{0?} {date?} {month} {year?}','{0?} {weekday} {shift}']});Date.addLocale('it',{'plural':true,'months':'Gennaio,Febbraio,Marzo,Aprile,Maggio,Giugno,Luglio,Agosto,Settembre,Ottobre,Novembre,Dicembre','weekdays':'Domenica,Luned:ì|i,Marted:ì|i,Mercoled:ì|i,Gioved:ì|i,Venerd:ì|i,Sabato','units':'millisecond:o|i,second:o|i,minut:o|i,or:a|e,giorn:o|i,settiman:a|e,mes:e|i,ann:o|i','numbers':"un:|a|o|',due,tre,quattro,cinque,sei,sette,otto,nove,dieci",'tokens':"l'|la|il",'short':'{d} {Month} {yyyy}','long':'{d} {Month} {yyyy} {H}:{mm}','full':'{Weekday} {d} {Month} {yyyy} {H}:{mm}:{ss}','past':'{num} {unit} {sign}','future':'{num} {unit} {sign}','duration':'{num} {unit}','timeMarker':'alle','ampm':'am,pm','modifiers':[{'name':'day','src':'ieri','value':-1},{'name':'day','src':'oggi','value':0},{'name':'day','src':'domani','value':1},{'name':'day','src':'dopodomani','value':2},{'name':'sign','src':'fa','value':-1},{'name':'sign','src':'da adesso','value':1},{'name':'shift','src':'scors:o|a','value':-1},{'name':'shift','src':'prossim:o|a','value':1}],'dateParse':['{num} {unit} {sign}','{0?} {unit=5-7} {shift}','{0?} {shift} {unit=5-7}'],'timeParse':['{weekday?} {date?} {month} {year?}','{shift} {weekday}']});Date.addLocale('ja',{'monthSuffix':'月','weekdays':'日曜日,月曜日,火曜日,水曜日,木曜日,金曜日,土曜日','units':'ミリ秒,秒,分,時間,日,週間|週,ヶ月|ヵ月|月,年','short':'{yyyy}年{M}月{d}日','long':'{yyyy}年{M}月{d}日 {H}時{mm}分','full':'{yyyy}年{M}月{d}日 {Weekday} {H}時{mm}分{ss}秒','past':'{num}{unit}{sign}','future':'{num}{unit}{sign}','duration':'{num}{unit}','timeSuffixes':'時,分,秒','ampm':'午前,午後','modifiers':[{'name':'day','src':'一昨日','value':-2},{'name':'day','src':'昨日','value':-1},{'name':'day','src':'今日','value':0},{'name':'day','src':'明日','value':1},{'name':'day','src':'明後日','value':2},{'name':'sign','src':'前','value':-1},{'name':'sign','src':'後','value':1},{'name':'shift','src':'去|先','value':-1},{'name':'shift','src':'来','value':1}],'dateParse':['{num}{unit}{sign}'],'timeParse':['{shift}{unit=5-7}{weekday?}','{year}年{month?}月?{date?}日?','{month}月{date?}日?','{date}日']});Date.addLocale('ko',{'digitDate':true,'monthSuffix':'월','weekdays':'일요일,월요일,화요일,수요일,목요일,금요일,토요일','units':'밀리초,초,분,시간,일,주,개월|달,년','numbers':'일|한,이,삼,사,오,육,칠,팔,구,십','short':'{yyyy}년{M}월{d}일','long':'{yyyy}년{M}월{d}일 {H}시{mm}분','full':'{yyyy}년{M}월{d}일 {Weekday} {H}시{mm}분{ss}초','past':'{num}{unit} {sign}','future':'{num}{unit} {sign}','duration':'{num}{unit}','timeSuffixes':'시,분,초','ampm':'오전,오후','modifiers':[{'name':'day','src':'그저께','value':-2},{'name':'day','src':'어제','value':-1},{'name':'day','src':'오늘','value':0},{'name':'day','src':'내일','value':1},{'name':'day','src':'모레','value':2},{'name':'sign','src':'전','value':-1},{'name':'sign','src':'후','value':1},{'name':'shift','src':'지난|작','value':-1},{'name':'shift','src':'이번','value':0},{'name':'shift','src':'다음|내','value':1}],'dateParse':['{num}{unit} {sign}','{shift?} {unit=5-7}'],'timeParse':['{shift} {unit=5?} {weekday}','{year}년{month?}월?{date?}일?','{month}월{date?}일?','{date}일']});Date.addLocale('nl',{'plural':true,'months':'januari,februari,maart,april,mei,juni,juli,augustus,september,oktober,november,december','weekdays':'zondag|zo,maandag|ma,dinsdag|di,woensdag|woe|wo,donderdag|do,vrijdag|vrij|vr,zaterdag|za','units':'milliseconde:|n,seconde:|n,minu:ut|ten,uur,dag:|en,we:ek|ken,maand:|en,jaar','numbers':'een,twee,drie,vier,vijf,zes,zeven,acht,negen','tokens':'','short':'{d} {Month} {yyyy}','long':'{d} {Month} {yyyy} {H}:{mm}','full':'{Weekday} {d} {Month} {yyyy} {H}:{mm}:{ss}','past':'{num} {unit} {sign}','future':'{num} {unit} {sign}','duration':'{num} {unit}','timeMarker':"'s|om",'modifiers':[{'name':'day','src':'gisteren','value':-1},{'name':'day','src':'vandaag','value':0},{'name':'day','src':'morgen','value':1},{'name':'day','src':'overmorgen','value':2},{'name':'sign','src':'geleden','value':-1},{'name':'sign','src':'vanaf nu','value':1},{'name':'shift','src':'laatste|vorige|afgelopen','value':-1},{'name':'shift','src':'volgend:|e','value':1}],'dateParse':['{num} {unit} {sign}','{0?} {unit=5-7} {shift}','{0?} {shift} {unit=5-7}'],'timeParse':['{weekday?} {date?} {month} {year?}','{shift} {weekday}']});Date.addLocale('pl',{'plural':true,'months':'Styczeń|Stycznia,Luty|Lutego,Marzec|Marca,Kwiecień|Kwietnia,Maj|Maja,Czerwiec|Czerwca,Lipiec|Lipca,Sierpień|Sierpnia,Wrzesień|Września,Październik|Października,Listopad|Listopada,Grudzień|Grudnia','weekdays':'Niedziela|Niedzielę,Poniedziałek,Wtorek,Środ:a|ę,Czwartek,Piątek,Sobota|Sobotę','units':'milisekund:a|y|,sekund:a|y|,minut:a|y|,godzin:a|y|,dzień|dni,tydzień|tygodnie|tygodni,miesiące|miesiące|miesięcy,rok|lata|lat','numbers':'jeden|jedną,dwa|dwie,trzy,cztery,pięć,sześć,siedem,osiem,dziewięć,dziesięć','optionals':'w|we,roku','short':'{d} {Month} {yyyy}','long':'{d} {Month} {yyyy} {H}:{mm}','full':'{Weekday}, {d} {Month} {yyyy} {H}:{mm}:{ss}','past':'{num} {unit} {sign}','future':'{sign} {num} {unit}','duration':'{num} {unit}','timeMarker':'o','ampm':'am,pm','modifiers':[{'name':'day','src':'przedwczoraj','value':-2},{'name':'day','src':'wczoraj','value':-1},{'name':'day','src':'dzisiaj|dziś','value':0},{'name':'day','src':'jutro','value':1},{'name':'day','src':'pojutrze','value':2},{'name':'sign','src':'temu|przed','value':-1},{'name':'sign','src':'za','value':1},{'name':'shift','src':'zeszły|zeszła|ostatni|ostatnia','value':-1},{'name':'shift','src':'następny|następna|następnego|przyszły|przyszła|przyszłego','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{month} {year}','{shift} {unit=5-7}','{0} {shift?} {weekday}'],'timeParse':['{date} {month} {year?} {1}','{0} {shift?} {weekday}']});Date.addLocale('pt',{'plural':true,'months':'janeiro,fevereiro,março,abril,maio,junho,julho,agosto,setembro,outubro,novembro,dezembro','weekdays':'domingo,segunda-feira,terça-feira,quarta-feira,quinta-feira,sexta-feira,sábado|sabado','units':'milisegundo:|s,segundo:|s,minuto:|s,hora:|s,dia:|s,semana:|s,mês|mêses|mes|meses,ano:|s','numbers':'um,dois,três|tres,quatro,cinco,seis,sete,oito,nove,dez,uma,duas','tokens':'a,de','short':'{d} de {month} de {yyyy}','long':'{d} de {month} de {yyyy} {H}:{mm}','full':'{Weekday}, {d} de {month} de {yyyy} {H}:{mm}:{ss}','past':'{num} {unit} {sign}','future':'{sign} {num} {unit}','duration':'{num} {unit}','timeMarker':'às','ampm':'am,pm','modifiers':[{'name':'day','src':'anteontem','value':-2},{'name':'day','src':'ontem','value':-1},{'name':'day','src':'hoje','value':0},{'name':'day','src':'amanh:ã|a','value':1},{'name':'sign','src':'atrás|atras|há|ha','value':-1},{'name':'sign','src':'daqui a','value':1},{'name':'shift','src':'passad:o|a','value':-1},{'name':'shift','src':'próximo|próxima|proximo|proxima','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{0?} {unit=5-7} {shift}','{0?} {shift} {unit=5-7}'],'timeParse':['{date?} {1?} {month} {1?} {year?}','{0?} {shift} {weekday}']});Date.addLocale('ru',{'months':'Январ:я|ь,Феврал:я|ь,Март:а|,Апрел:я|ь,Ма:я|й,Июн:я|ь,Июл:я|ь,Август:а|,Сентябр:я|ь,Октябр:я|ь,Ноябр:я|ь,Декабр:я|ь','weekdays':'Воскресенье,Понедельник,Вторник,Среда,Четверг,Пятница,Суббота','units':'миллисекунд:а|у|ы|,секунд:а|у|ы|,минут:а|у|ы|,час:||а|ов,день|день|дня|дней,недел:я|ю|и|ь|е,месяц:||а|ев|е,год|год|года|лет|году','numbers':'од:ин|ну,дв:а|е,три,четыре,пять,шесть,семь,восемь,девять,десять','tokens':'в|на,года','short':'{d} {month} {yyyy} года','long':'{d} {month} {yyyy} года {H}:{mm}','full':'{Weekday} {d} {month} {yyyy} года {H}:{mm}:{ss}','relative':function(num,unit,ms,format){var numberWithUnit,last=num.toString().slice(-1);switch(true){case num>=11&&num<=15:mult=3;break;case last==1:mult=1;break;case last>=2&&last<=4:mult=2;break;default:mult=3;}
numberWithUnit=num+' '+this['units'][(mult*8)+unit];switch(format){case'duration':return numberWithUnit;case'past':return numberWithUnit+' назад';case'future':return'через '+numberWithUnit;}},'timeMarker':'в','ampm':' утра, вечера','modifiers':[{'name':'day','src':'позавчера','value':-2},{'name':'day','src':'вчера','value':-1},{'name':'day','src':'сегодня','value':0},{'name':'day','src':'завтра','value':1},{'name':'day','src':'послезавтра','value':2},{'name':'sign','src':'назад','value':-1},{'name':'sign','src':'через','value':1},{'name':'shift','src':'прошл:ый|ой|ом','value':-1},{'name':'shift','src':'следующ:ий|ей|ем','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{month} {year}','{0?} {shift} {unit=5-7}'],'timeParse':['{date} {month} {year?} {1?}','{0?} {shift} {weekday}']});Date.addLocale('sv',{'plural':true,'months':'januari,februari,mars,april,maj,juni,juli,augusti,september,oktober,november,december','weekdays':'söndag|sondag,måndag:|en+mandag:|en,tisdag,onsdag,torsdag,fredag,lördag|lordag','units':'millisekund:|er,sekund:|er,minut:|er,timm:e|ar,dag:|ar,veck:a|or|an,månad:|er|en+manad:|er|en,år:||et+ar:||et','numbers':'en|ett,två|tva,tre,fyra,fem,sex,sju,åtta|atta,nio,tio','tokens':'den,för|for','articles':'den','short':'den {d} {month} {yyyy}','long':'den {d} {month} {yyyy} {H}:{mm}','full':'{Weekday} den {d} {month} {yyyy} {H}:{mm}:{ss}','past':'{num} {unit} {sign}','future':'{sign} {num} {unit}','duration':'{num} {unit}','ampm':'am,pm','modifiers':[{'name':'day','src':'förrgår|i förrgår|iförrgår|forrgar|i forrgar|iforrgar','value':-2},{'name':'day','src':'går|i går|igår|gar|i gar|igar','value':-1},{'name':'day','src':'dag|i dag|idag','value':0},{'name':'day','src':'morgon|i morgon|imorgon','value':1},{'name':'day','src':'över morgon|övermorgon|i över morgon|i övermorgon|iövermorgon|over morgon|overmorgon|i over morgon|i overmorgon|iovermorgon','value':2},{'name':'sign','src':'sedan|sen','value':-1},{'name':'sign','src':'om','value':1},{'name':'shift','src':'i förra|förra|i forra|forra','value':-1},{'name':'shift','src':'denna','value':0},{'name':'shift','src':'nästa|nasta','value':1}],'dateParse':['{num} {unit} {sign}','{sign} {num} {unit}','{1?} {num} {unit} {sign}','{shift} {unit=5-7}'],'timeParse':['{0?} {weekday?} {date?} {month} {year}','{date} {month}','{shift} {weekday}']});Date.addLocale('zh-CN',{'variant':true,'monthSuffix':'月','weekdays':'星期日|周日,星期一|周一,星期二|周二,星期三|周三,星期四|周四,星期五|周五,星期六|周六','units':'毫秒,秒钟,分钟,小时,天,个星期|周,个月,年','tokens':'日|号','short':'{yyyy}年{M}月{d}日','long':'{yyyy}年{M}月{d}日 {tt}{h}:{mm}','full':'{yyyy}年{M}月{d}日 {weekday} {tt}{h}:{mm}:{ss}','past':'{num}{unit}{sign}','future':'{num}{unit}{sign}','duration':'{num}{unit}','timeSuffixes':'点|时,分钟?,秒','ampm':'上午,下午','modifiers':[{'name':'day','src':'前天','value':-2},{'name':'day','src':'昨天','value':-1},{'name':'day','src':'今天','value':0},{'name':'day','src':'明天','value':1},{'name':'day','src':'后天','value':2},{'name':'sign','src':'前','value':-1},{'name':'sign','src':'后','value':1},{'name':'shift','src':'上|去','value':-1},{'name':'shift','src':'这','value':0},{'name':'shift','src':'下|明','value':1}],'dateParse':['{num}{unit}{sign}','{shift}{unit=5-7}'],'timeParse':['{shift}{weekday}','{year}年{month?}月?{date?}{0?}','{month}月{date?}{0?}','{date}[日号]']});Date.addLocale('zh-TW',{'monthSuffix':'月','weekdays':'星期日|週日,星期一|週一,星期二|週二,星期三|週三,星期四|週四,星期五|週五,星期六|週六','units':'毫秒,秒鐘,分鐘,小時,天,個星期|週,個月,年','tokens':'日|號','short':'{yyyy}年{M}月{d}日','long':'{yyyy}年{M}月{d}日 {tt}{h}:{mm}','full':'{yyyy}年{M}月{d}日 {Weekday} {tt}{h}:{mm}:{ss}','past':'{num}{unit}{sign}','future':'{num}{unit}{sign}','duration':'{num}{unit}','timeSuffixes':'點|時,分鐘?,秒','ampm':'上午,下午','modifiers':[{'name':'day','src':'前天','value':-2},{'name':'day','src':'昨天','value':-1},{'name':'day','src':'今天','value':0},{'name':'day','src':'明天','value':1},{'name':'day','src':'後天','value':2},{'name':'sign','src':'前','value':-1},{'name':'sign','src':'後','value':1},{'name':'shift','src':'上|去','value':-1},{'name':'shift','src':'這','value':0},{'name':'shift','src':'下|明','value':1}],'dateParse':['{num}{unit}{sign}','{shift}{unit=5-7}'],'timeParse':['{shift}{weekday}','{year}年{month?}月?{date?}{0?}','{month}月{date?}{0?}','{date}[日號]']});})();});require.define("/node_modules/sentence-tokenizer/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={"main":"lib/tokenizer.js"}});require.define("/node_modules/sentence-tokenizer/lib/tokenizer.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var debug=require('debug')('tokenizer');var sugar=require('sugar');function Tokenizer(username,botname){this.username=username||'Guy';this.entry=null;this.sentences=null;if(typeof botname=='string'){this.botname=botname;}
else{this.botname='ECTOR';}}
Tokenizer.prototype={setEntry:function(entry){this.entry=entry.compact();this.sentences=null;},getSentences:function(){var words=this.entry.words();var endingWords=words.filter(function(w){return w.endsWith(/[\.!\?]/);});var self=this;self.sentences=[];var botnameRegExp=new RegExp("\\W?"+self.botname.normalize()+"\\W?");var usernameRegExp=new RegExp("\\W?"+self.username.normalize()+"\\W?");if(words.length===1){var word=words[0];var wordNormalized=word.normalize();var wordReplaced;if(wordNormalized.search(botnameRegExp)!==-1){wordReplaced=word.replace(self.botname,"{yourname}");}
else if(wordNormalized.search(usernameRegExp)!==-1){wordReplaced=word.replace(self.username,"{myname}");}
self.sentences.push(word);return[word];}
words.reduce(function(prev,cur,index,array){var curNormalized=cur.normalize();var curReplaced=cur;if(curNormalized.search(botnameRegExp)!==-1){curReplaced=cur.replace(self.botname,"{yourname}");}
else if(curNormalized.search(usernameRegExp)!==-1){curReplaced=cur.replace(self.username,"{myname}");}
prev=prev+" "+curReplaced;if(endingWords.indexOf(cur)!=-1||index===array.length-1)
{self.sentences.push(prev.compact());prev="";}
return prev;});return this.sentences;},getTokens:function(sentenceIndex){var s=0;if(typeof sentenceIndex==='number')s=sentenceIndex;return this.sentences[s].words();}};module.exports=Tokenizer;});require.define("/node_modules/concept-network/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={"main":"index"}});require.define("/node_modules/concept-network/index.js",function(require,module,exports,__dirname,__filename,process,global){module.exports.ConceptNetwork=require('./lib/concept-network').ConceptNetwork;module.exports.ConceptNetworkState=require('./lib/concept-network-state').ConceptNetworkState;});require.define("/node_modules/concept-network/lib/concept-network.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";function ConceptNetwork(){if(!(this instanceof ConceptNetwork)){return new ConceptNetwork();}
this.node={};this.link={};this.nodeLastId=0;this.labelIndex={};this.fromIndex={};this.toIndex={};}
ConceptNetwork.prototype={addNode:function(label){var id;if(this.labelIndex.hasOwnProperty(label)){id=this.labelIndex[label];this.node[id].occ+=1;}else{this.nodeLastId+=1;id=this.nodeLastId;this.node[id]={id:id,label:label,occ:1};this.labelIndex[label]=id;}
return this.node[id];},decrementNode:function(label){var id;if(this.labelIndex.hasOwnProperty(label)){id=this.labelIndex[label];this.node[id].occ-=1;if(this.node[id].occ===0){this.removeNode(id);return null;}}else{return null;}
return this.node[id];},removeNode:function(id){var linksToRemove=[];var i;if(this.fromIndex[id]){for(i=0;i<this.fromIndex[id].length;i+=1){linksToRemove.push(this.fromIndex[id][i]);}}
if(this.toIndex[id]){for(i=0;i<this.toIndex[id].length;i+=1){linksToRemove.push(this.toIndex[id][i]);}}
for(i=0;i<linksToRemove.length;i+=1){this.removeLink(linksToRemove[i]);}
var label=this.node[id].label;delete this.node[id];delete this.labelIndex[label];},addLink:function(fromId,toId){if(typeof fromId!=='number'){return new Error('fromId should be a number');}
if(typeof toId!=='number'){return new Error('toId should be a number');}
var linkId=fromId+'_'+toId;if(typeof this.link[linkId]==='undefined'){this.link[linkId]={fromId:fromId,toId:toId,coOcc:1};if(!this.fromIndex.hasOwnProperty(fromId)){this.fromIndex[fromId]=[];}
this.fromIndex[fromId].push(linkId);if(!this.toIndex.hasOwnProperty(toId)){this.toIndex[toId]=[];}
this.toIndex[toId].push(linkId);}else{this.link[linkId].coOcc+=1;}
return this.link[linkId];},decrementLink:function(linkId){var link=this.link[linkId];link.coOcc-=1;if(link.coOcc===0){this.removeLink(linkId);}
return link;},removeLink:function(linkId){var link=this.link[linkId];delete this.fromIndex[link.fromId];delete this.toIndex[link.toId];delete this.link[linkId];},getNode:function(label){var id=this.labelIndex[label];if(typeof this.node[id]==='undefined'){return null;}
return(this.node[id]);},getLink:function(linkId){if(typeof this.link[linkId]==='undefined'){return null;}
return this.link[linkId];},getNodeFromLinks:function(id){var fromLinks=this.fromIndex[id];if(typeof fromLinks==='undefined'){return[];}
return fromLinks;},getNodeToLinks:function(id){var toLinks=this.toIndex[id];if(typeof toLinks==='undefined'){return[];}
return toLinks;}};module.exports.ConceptNetwork=ConceptNetwork;});require.define("/node_modules/concept-network/lib/concept-network-state.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var sugar=require('sugar');var debug=require('debug')('concept-network-state');var ConceptNetwork=require('../index').ConceptNetwork;function ConceptNetworkState(cn){if(!(this instanceof ConceptNetworkState)){return new ConceptNetworkState();}
this.nodeState={};this.cn=cn;if(!(cn instanceof ConceptNetwork)){throw new Error("Parameter is required");}
this.normalNumberComingLinks=2;}
ConceptNetworkState.prototype={activate:function(nodeId){if(typeof this.nodeState[nodeId]==='undefined'){this.nodeState[nodeId]={activationValue:100,age:0,oldActivationValue:0};}
else{this.nodeState[nodeId].activationValue=100;}},getActivationValue:function(nodeId){if(typeof this.nodeState[nodeId]==='undefined'){return 0;}
else{return this.nodeState[nodeId].activationValue;}},setActivationValue:function(nodeId,value){debug('this.nodeState',this.nodeState);debug('nodeId',nodeId);debug('value',value);if(typeof this.nodeState[nodeId]==='undefined'){this.nodeState[nodeId]={activationValue:value,age:0,oldActivationValue:0};}
else{this.nodeState[nodeId].activationValue=value;}
if(!value){delete this.nodeState[nodeId];}},getOldActivationValue:function(nodeId){if(typeof this.nodeState[nodeId]==='undefined'){return 0;}
else{return this.nodeState[nodeId].oldActivationValue;}},getMaximumActivationValue:function(filter){var max=0;if(typeof filter==='undefined'){var maxId=Object.max(this.nodeState,'activationValue');if(typeof maxId==='undefined'){return 0;}
max=this.nodeState[maxId].activationValue;}
else{for(var id in this.nodeState){var node=this.cn.node[id];if(node.label.startsWith(filter)){max=Math.max(max,this.nodeState[id].activationValue);}}}
return max;},getActivatedTypedNodes:function(filter,threshold){var array=[];if(typeof threshold==='undefined'){threshold=90;}
if(typeof filter==='undefined'){filter='';}
for(var id in this.nodeState){var node=this.cn.node[id];var activationValue=this.getActivationValue(id);if(node.label.startsWith(filter)){if(activationValue>threshold){array.push({node:node,activationValue:activationValue});}}}
return array;},propagate:function(){var influenceNb=[];var influenceValue=[];for(var nodeId in this.nodeState){this.nodeState[nodeId].age+=1;this.nodeState[nodeId].oldActivationValue=this.nodeState[nodeId].activationValue;}
for(nodeId in this.cn.node){var ov=this.getOldActivationValue(nodeId);var links=this.cn.getNodeFromLinks(nodeId);debug('links',links);for(var linkIndex in links){debug('linkIndex',linkIndex);var linkId=links[linkIndex];debug('linkId',linkId);var link=this.cn.getLink(linkId);debug('link',link);var nodeToId=link.toId;var infl=typeof influenceValue[nodeToId]!=="undefined"?influenceValue[nodeToId]:0;infl+=0.5+ov*link.coOcc;influenceValue[nodeToId]=infl;influenceNb[nodeToId]=typeof influenceNb[nodeToId]!=="undefined"?influenceNb[nodeToId]:0;influenceNb[nodeToId]+=1;}}
debug('influenceNb',influenceNb);debug('influenceValue',influenceValue);for(nodeId in this.cn.node){var nodeState=this.nodeState[nodeId];if(typeof nodeState==='undefined'){nodeState={activationValue:0,oldActivationValue:0,age:0};}
var decay=40;var memoryPerf=100;var minusAge=200/(1+Math.exp(-nodeState.age/memoryPerf))-100;var newActivationValue;if(typeof influenceValue[nodeId]==='undefined'||!influenceValue[nodeId]){newActivationValue=nodeState.oldActivationValue-decay*nodeState.oldActivationValue/100-minusAge;}
else{var influence=influenceValue[nodeId];var nbIncomings=influenceNb[nodeId];influence/=Math.log(this.normalNumberComingLinks+nbIncomings)/Math.log(this.normalNumberComingLinks);newActivationValue=nodeState.oldActivationValue-decay*nodeState.oldActivationValue/100+influence-minusAge;}
newActivationValue=Math.max(newActivationValue,0);newActivationValue=Math.min(newActivationValue,100);this.setActivationValue(nodeId,newActivationValue);}}};module.exports.ConceptNetworkState=ConceptNetworkState;});require.define("/node_modules/random-weighted-choice/package.json",function(require,module,exports,__dirname,__filename,process,global){module.exports={"main":"lib/random-weighted-choice.js"}});require.define("/node_modules/random-weighted-choice/lib/random-weighted-choice.js",function(require,module,exports,__dirname,__filename,process,global){"use strict";var debug=require('debug')('rwc');var RandomWeightedChoice=function(table,temperature,randomFunction,influence){influence=influence||2;if(typeof(temperature)=="undefined")temperature=50;temperature=temperature|50;debug('temperature',temperature);var T=(temperature-50)/50;if(typeof(randomFunction)=="undefined")randomFunction=Math.random;var nb=table.length;if(!nb)return null;var total=0;table.forEach(function(element,index){total+=element.weight;});var avg=total/nb;debug('total',total);debug('nb',nb);debug('avg',avg);var ur={};var urgencySum=0;table.forEach(function(element,index){var urgency=element.weight+T*influence*(avg-element.weight);if(urgency<0)urgency=0;urgencySum+=urgency;ur[element.id]=(ur[element.id]||0)+urgency;});var cumulatedUrgencies={};var currentUrgency=0;Object.keys(ur).forEach(function(id,index){currentUrgency+=ur[id];cumulatedUrgencies[id]=currentUrgency;});if(urgencySum<1)return null;var choice=randomFunction()*urgencySum;debug('ur',ur);debug('cumulatedUrgencies',cumulatedUrgencies);debug('urgencySum',urgencySum);debug('choice',choice);var ids=Object.keys(cumulatedUrgencies);for(var i=0;i<ids.length;i++){var id=ids[i];var urgency=cumulatedUrgencies[id];if(choice<=urgency){debug('return',id);return id;}}};module.exports=RandomWeightedChoice;});